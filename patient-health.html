<!DOCTYPE html>
<html lang="en" data-theme="matte">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HealthFlo ‚Äî Patient Health Board</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/patient-os.css">
</head>
<body>
  <header class="hf-topbar">
    <div class="container topbar-inner">
      <a class="hf-logo" href="patient-dashboard.html"><span class="logo-dot"></span>HealthFlo Patient OS</a>
      <nav class="hf-nav">
        <a href="patient-dashboard.html">Dashboard</a>
        <a class="active" href="patient-health.html">Health</a>
        <a href="patient-organs.html">Organs</a>
        <a href="patient-profile.html">Profile</a>
        <a href="patient-hospitals.html">Hospitals</a>
        <a href="patient-pharmacy.html">Pharmacy</a>
        <a href="patient-labs.html">Labs</a>
        <a href="patient-devices.html">Devices</a>
        <a href="patient-family.html">Family</a>
        <a href="patient-insurance.html">Insurance</a>
        <a href="patient-settings.html">Settings</a>
      </nav>
      <div class="topbar-actions">
        <button class="icon-btn" id="themeToggle">üåì</button>
        <button class="icon-btn">üîî</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="hero-card">
        <p class="chip">Live vitals & labs</p>
        <h1 class="hero-title">Real-time health status</h1>
        <p class="hero-sub">Live vitals with Wi‚ÄëFi / BLE pairing, family mirroring, hydration and anemia checks, lab intelligence, and radiology snapshots.</p>
        <p class="notice">Pharmacy dashboards now mirror this board with 10+ meds per therapeutic category ‚Äî <a href="patient-pharmacy.html">open pharmacy</a>.</p>
        <div class="hero-actions">
          <span class="badge">Auto-sync devices</span>
          <span class="badge">Family live view</span>
          <span class="badge">Matte + VOKA themes</span>
        </div>
      </div>
      <div class="card">
        <h3>Live vitals (demo feed)</h3>
        <div class="vitals-grid">
          <div class="vital-card">
            <small>Heart rate</small>
            <span class="vital-value" id="v_hr">--</span>
            <small>bpm</small>
          </div>
          <div class="vital-card">
            <small>Blood pressure</small>
            <span class="vital-value" id="v_bp">--</span>
            <small>mmHg</small>
          </div>
          <div class="vital-card">
            <small>SpO‚ÇÇ</small>
            <span class="vital-value" id="v_spo2">--</span>
            <small>oxygen</small>
          </div>
          <div class="vital-card">
            <small>Body temp</small>
            <span class="vital-value" id="v_temp">--</span>
            <small>core</small>
          </div>
        </div>
        <div class="notice" id="ai_summary">Guardian AI summarises vitals in simple words.</div>
      </div>
    </section>

    <section class="section">
      <header>
        <div>
          <p class="chip">Blood + hydration</p>
          <h2 class="section-title">Blood status</h2>
          <p class="section-sub">HB, hydration, infection and anemia signals calculated from CBC.</p>
        </div>
      </header>
      <div class="stat-grid">
        <div class="stat">
          <small>Hemoglobin</small>
          <strong id="hb_value">13.5 g/dL</strong>
          <span id="hb_msg">Within range</span>
        </div>
        <div class="stat">
          <small>Hydration</small>
          <strong id="water_value">Good</strong>
          <span id="water_msg">Keep sipping</span>
        </div>
        <div class="stat">
          <small>Infection status</small>
          <strong id="infection_value">Low</strong>
          <span id="infection_msg">No signals</span>
        </div>
        <div class="stat">
          <small>Anemia status</small>
          <strong id="anemia_value">Clear</strong>
          <span id="anemia_msg">Iron looks fine</span>
        </div>
      </div>
      <div class="notice" id="blood_signal">Balanced</div>
    </section>

    <section class="section">
      <header>
        <div>
          <p class="chip">Lab intelligence</p>
          <h2 class="section-title">CBC, LFT, KFT, CUE, cardiac, lung, dental</h2>
          <p class="section-sub">Plain language AI notes per panel.</p>
        </div>
      </header>
      <div class="list-grid">
        <div class="card">
          <h3>CBC & blood</h3>
          <p class="notice" id="lab_cbc_ai">Blood looks balanced. No infection seen.</p>
          <div class="stat-grid">
            <div class="stat"><small>RBC</small><strong id="lab_rbc">--</strong></div>
            <div class="stat"><small>WBC</small><strong id="lab_wbc">--</strong></div>
            <div class="stat"><small>Platelets</small><strong id="lab_platelets">--</strong></div>
          </div>
          <div class="chip-row"><span class="chip" id="cbc_signal">Normal</span><span class="chip">HB/Hydration</span></div>
        </div>
        <div class="card">
          <h3>LFT ‚Äî liver</h3>
          <p class="notice" id="lab_lft_ai">Liver values inside normal range.</p>
          <div class="stat-grid">
            <div class="stat"><small>SGOT</small><strong id="lab_sgot">--</strong></div>
            <div class="stat"><small>SGPT</small><strong id="lab_sgpt">--</strong></div>
            <div class="stat"><small>Bilirubin</small><strong id="lab_bilirubin">--</strong></div>
          </div>
          <div class="chip-row"><span class="chip" id="lft_signal">Good</span><span class="chip">Avoid oil</span></div>
        </div>
        <div class="card">
          <h3>KFT + CUE ‚Äî kidney</h3>
          <p class="notice" id="lab_kft_ai">Kidney filters are working well.</p>
          <div class="stat-grid">
            <div class="stat"><small>Creatinine</small><strong id="lab_creatinine">--</strong></div>
            <div class="stat"><small>Urea</small><strong id="lab_urea">--</strong></div>
            <div class="stat"><small>Sodium</small><strong id="lab_sodium">--</strong></div>
          </div>
          <div class="chip-row"><span class="chip" id="kft_signal">Hydrated</span><span class="chip">CUE synced</span></div>
        </div>
        <div class="card">
          <h3>Cardiac markers</h3>
          <p class="notice" id="lab_cardiac_ai">Heart stress markers are low.</p>
          <div class="stat-grid">
            <div class="stat"><small>Troponin</small><strong id="lab_troponin">--</strong></div>
            <div class="stat"><small>CRP</small><strong id="lab_crp">--</strong></div>
            <div class="stat"><small>BNP</small><strong id="lab_bnp">--</strong></div>
          </div>
          <div class="chip-row"><span class="chip" id="cardiac_signal">Calm</span><span class="chip">Rhythm steady</span></div>
        </div>
        <div class="card">
          <h3>Lungs (Spirometry & SpO‚ÇÇ)</h3>
          <p class="notice" id="lab_lung_ai">Breathing looks smooth.</p>
          <div class="stat-grid">
            <div class="stat"><small>Spirometry</small><strong id="lab_spirometry">--</strong></div>
            <div class="stat"><small>SpO‚ÇÇ trend</small><strong id="lab_spo2">--</strong></div>
            <div class="stat"><small>Resp rate</small><strong id="lab_resp">--</strong></div>
          </div>
          <div class="chip-row"><span class="chip" id="lung_signal">Free</span><span class="chip">Resp coaching</span></div>
        </div>
        <div class="card">
          <h3>Dental</h3>
          <p class="notice" id="lab_dental_ai">3D CBCT and dental scans synced.</p>
          <div class="stat-grid">
            <div class="stat"><small>CBCT</small><strong id="lab_cbct">Clean</strong></div>
            <div class="stat"><small>Cavities</small><strong id="lab_cavity">None</strong></div>
            <div class="stat"><small>Gums</small><strong id="lab_gums">Healthy</strong></div>
          </div>
          <div class="chip-row"><span class="chip" id="dental_signal">Bright</span><span class="chip">Hygiene tips</span></div>
        </div>
      </div>
    </section>

    <section class="section">
      <header>
        <div>
          <p class="chip">Doctor lens</p>
          <h2 class="section-title">Date-wise lab reports mapped from Labs</h2>
          <p class="section-sub">The Labs page now pushes every booked slot and result into this doctor-style timeline.</p>
        </div>
      </header>
      <div id="lab_timeline" class="timeline-grid"></div>
     </section>

    <section class="section">
      <header>
        <div>
          <p class="chip">PDF vault</p>
          <h2 class="section-title">Doctor-ready lab PDFs</h2>
          <p class="section-sub">Download or share premium reports mirrored from Labs with narration and status.</p>
        </div>
      </header>
      <div id="health_report_shelf" class="report-grid"></div>
    </section>

    <section class="section">
      <header>
        <div>
          <p class="chip">Radiology</p>
          <h2 class="section-title">Radiology board</h2>
          <p class="section-sub">USG abdomen, pelvis, mammogram, soft tissue, MRI/CT head & spine, 3D CBCT tracked with status.</p>
        </div>
      </header>
      <div class="table-card card">
        <table>
          <thead>
            <tr><th>Study</th><th>Status</th><th>Last update</th></tr>
          </thead>
          <tbody>
            <tr data-rad-study="usg-abdomen"><td>USG Abdomen</td><td><span class="chip" data-rad-status>Ready</span></td><td><span data-rad-eta>Today</span></td></tr>
            <tr data-rad-study="usg-pelvis"><td>USG Pelvis</td><td><span class="chip" data-rad-status>Ready</span></td><td><span data-rad-eta>Today</span></td></tr>
            <tr data-rad-study="mammogram"><td>Mammogram</td><td><span class="chip" data-rad-status>Pending upload</span></td><td><span data-rad-eta>-</span></td></tr>
            <tr data-rad-study="ct-head"><td>MRI / CT Head</td><td><span class="chip" data-rad-status>Scheduled</span></td><td><span data-rad-eta>Tomorrow</span></td></tr>
            <tr data-rad-study="spine"><td>Neck / Spine MRI</td><td><span class="chip" data-rad-status>Reporting</span></td><td><span data-rad-eta>In progress</span></td></tr>
            <tr data-rad-study="cbct"><td>3D CBCT (Dental)</td><td><span class="chip" data-rad-status>Synced</span></td><td><span data-rad-eta>Today</span></td></tr>
            <tr data-rad-study="soft-tissue"><td>Soft tissue scan</td><td><span class="chip" data-rad-status>Ready</span></td><td><span data-rad-eta>Today</span></td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="section">
      <header>
        <div>
          <p class="chip">Devices & SOS</p>
          <h2 class="section-title">Pair devices and ambulance automations</h2>
          <p class="section-sub">WIFI/BLE pairing feeds vitals; ambulance can be manual or auto-trigger with live location.</p>
        </div>
      </header>
      <div class="list-grid">
        <div class="card">
          <h3>Device pairing</h3>
          <p class="section-sub">Connect watches, BP cuffs, glucometers, spirometers.</p>
          <button class="badge primary" id="pairDevice">Scan for devices</button>
          <div class="stat-grid" id="device_list"></div>
        </div>
        <div class="card">
          <h3>Family live tracking</h3>
          <p class="section-sub">Share live vitals and organ alerts with trusted family on any device.</p>
          <button class="badge" id="familyMirror" data-state="off">Share live view with family</button>
          <div class="notice" id="family_status_msg">Family access paused.</div>
        </div>
        <div class="card">
          <h3>Ambulance support</h3>
          <p class="section-sub">Manual trigger or auto-trigger if vitals fall outside thresholds.</p>
          <div class="flex-row">
            <button class="badge primary" id="triggerEmergency">Trigger ambulance</button>
            <button class="badge" id="autoToggle">Auto trigger: OFF</button>
          </div>
        <div class="card">
          <h3>Pharmacy & meds</h3>
          <p class="section-sub">The new dual-dashboard pharmacy page mirrors Labs: search medicines by drug/brand/therapeutic use, find HealthFlo buffer pharmacies with live locations, and auto-sync back here.</p>
          <div class="flex-row">
            <a class="badge primary" href="patient-pharmacy.html">Open Pharmacy page</a>
            <span class="badge">HealthFlo buffer</span>
            <span class="badge">Live delivery tracker</span>
            <span class="badge">Substitutes</span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <nav class="neo-dock">
    <a class="dock-btn" href="patient-dashboard.html" aria-label="Dashboard">üè†</a>
    <a class="dock-btn active" href="patient-health.html" aria-label="Health">üíì</a>
    <a class="dock-btn" href="patient-organs.html" aria-label="Organs">ü´Ä</a>
    <a class="dock-btn" href="patient-profile.html" aria-label="Profile">üë§</a>
    <a class="dock-btn" href="patient-labs.html" aria-label="Labs">üß™</a>
    <a class="dock-btn" href="patient-hospitals.html" aria-label="Hospitals">üè•</a>
    <a class="dock-btn" href="patient-pharmacy.html" aria-label="Pharmacy">üíä</a>
    <a class="dock-btn" href="patient-devices.html" aria-label="Devices">üì°</a>
    <a class="dock-btn" href="patient-family.html" aria-label="Family">üë™</a>
    <a class="dock-btn" href="patient-insurance.html" aria-label="Insurance">üí≥</a>
    <a class="dock-btn" href="patient-settings.html" aria-label="Settings">‚öôÔ∏è</a>
  </nav>

  <footer>
    <p>¬© 2025 HealthFlo ‚Äî Health Board</p>
  </footer>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const safeParse = (key) => { try { return JSON.parse(localStorage.getItem(key)) || {}; } catch { return {}; } };
      const labSnap = safeParse('lab-dashboard-latest');
      const healthSnap = safeParse('health-board-status');
      const vitalsSnap = safeParse('dashboardVitals');

      const panels = labSnap.latestPanels || {};
      const reports = (labSnap.reports || []).slice().sort((a,b) => new Date(b.date) - new Date(a.date));
      const history = (labSnap.history || []).slice().sort((a,b) => new Date(b.date) - new Date(a.date));

      const setText = (id, text) => { const el = document.getElementById(id); if (el) el.textContent = text; };

      setText('v_hr', vitalsSnap.stats?.find(s => /heart/i.test(s.label))?.val || '--');
      setText('v_bp', vitalsSnap.stats?.find(s => /pressure|bp/i.test(s.label))?.val || '--');
      setText('v_spo2', `${panels.spirometry || '--'}`);
      setText('v_temp', `${panels.temperature ? panels.temperature.toFixed ? panels.temperature.toFixed(1) : panels.temperature : '--'}¬∞F`);

      setText('lab_rbc', `${panels.rbc || '--'} M/¬µL`);
      setText('lab_wbc', `${panels.wbc || '--'} k/¬µL`);
      setText('lab_platelets', `${panels.platelets || '--'} L`);
      setText('lab_sgot', `${panels.sgot || '--'} U/L`);
      setText('lab_sgpt', `${panels.sgpt || '--'} U/L`);
      setText('lab_bilirubin', `${panels.bilirubin || '--'} mg/dL`);
      setText('lab_creatinine', `${panels.creatinine || '--'} mg/dL`);
      setText('lab_urea', `${panels.urea || '--'} mg/dL`);
      setText('lab_sodium', `${panels.sodium || '--'} mmol/L`);
      setText('lab_troponin', panels.troponin || '--');
      setText('lab_crp', panels.crp || '--');
      setText('lab_bnp', panels.bnp || '--');
      setText('lab_spirometry', panels.spirometry || '--');
      setText('lab_spo2', vitalsSnap.stats?.find(s => /SpO/i.test(s.label))?.val || '--');
      setText('lab_resp', `${panels.resp || '16/min'}`);

      const summaryText = healthSnap.condition ? `${healthSnap.condition}: ${healthSnap.advice}` : 'Guardian AI summarises vitals in simple words.';
      setText('ai_summary', summaryText);
      setText('blood_signal', healthSnap.reasons?.[0] || 'Balanced');
      setText('cbc_signal', healthSnap.monitor?.join(', ') || 'Normal');
      setText('lab_cbc_ai', healthSnap.reasons?.join(' ‚Ä¢ ') || 'Blood looks balanced. No infection seen.');
      setText('lab_lft_ai', 'Liver values inside normal range.');
      setText('lab_kft_ai', 'Kidney filters are working well.');
      setText('lab_cardiac_ai', 'Heart stress markers are low.');
      setText('lab_lung_ai', panels.spirometry || 'Breathing looks smooth.');

      const timeline = document.getElementById('lab_timeline');
      if (timeline) {
        timeline.innerHTML = '';
        history.slice(0, 8).forEach(item => {
          const card = document.createElement('article');
          card.className = 'report-card';
          card.innerHTML = `<h4>${item.title || 'Lab slot'}</h4><div class="report-meta">${item.lab || 'Concierge lab'} ‚Ä¢ ${new Date(item.date).toLocaleString()}</div><div class="report-ai">${item.status || 'Ready'} ‚Äî ${item.note || 'Synced to dashboard.'}</div>`;
          timeline.appendChild(card);
        });
      }

      const shelf = document.getElementById('health_report_shelf');
      if (shelf) {
        shelf.innerHTML = '';
        reports.slice(0, 6).forEach(rep => {
          const card = document.createElement('article');
          card.className = 'report-card';
          card.innerHTML = `<h4>${rep.name}</h4><div class="report-meta">${rep.lab} ‚Ä¢ ${rep.doctor || 'Doctor lens'} ‚Ä¢ ${new Date(rep.date).toLocaleString()}</div><div class="report-ai">${rep.ai || 'Pending AI narration.'}</div>`;
          if (rep.parameters) {
            const tagRow = document.createElement('div');
            tagRow.className = 'report-tags';
            rep.parameters.slice(0,4).forEach(p => {
              const chip = document.createElement('span');
              chip.className = 'pill';
              chip.textContent = p;
              tagRow.appendChild(chip);
            });
            card.appendChild(tagRow);
          }
          shelf.appendChild(card);
        });
      }

      document.querySelectorAll('[data-rad-study]').forEach(row => {
        const study = row.getAttribute('data-rad-study');
        const statusEl = row.querySelector('[data-rad-status]');
        const etaEl = row.querySelector('[data-rad-eta]');
        const match = (labSnap.imagingReports || []).find(r => r.name.toLowerCase().includes(study.split('-')[0]));
        if (match && statusEl && etaEl) {
          statusEl.textContent = match.status || 'Ready';
          etaEl.textContent = new Date(match.date).toLocaleDateString();
        }
      });
    });
  </script>
</body>
</html>
