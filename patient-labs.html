<!DOCTYPE html>
<html lang="en" data-theme="matte">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HealthFlo ‚Äî Labs & Investigations</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/patient-os.css">
</head>
<body>
  <header class="hf-topbar">
    <div class="container topbar-inner">
      <a class="hf-logo" href="patient-dashboard.html"><span class="logo-dot"></span>HealthFlo Patient OS</a>
      <nav class="hf-nav">
        <a href="patient-dashboard.html">Dashboard</a>
        <a href="patient-health.html">Health</a>
        <a href="patient-organs.html">Organs</a>
        <a href="patient-profile.html">Profile</a>
        <a href="patient-hospitals.html">Hospitals</a>
        <a href="patient-pharmacy.html">Pharmacy</a>
        <a class="active" href="patient-labs.html">Labs</a>
        <a href="patient-insurance.html">Insurance</a>
        <a href="patient-settings.html">Settings</a>
      </nav>
      <div class="topbar-actions">
        <button class="icon-btn" id="themeToggle">üåì</button>
        <button class="icon-btn">üîî</button>
      </div>
    </div>
  </header>

  <main class="container labs-shell">
    <section class="section hero-grid">
      <div class="hero-card hero-elevated">
        <p class="chip">Labs & Radiology</p>
        <h1 class="hero-title">Book investigations faster with VOKA</h1>
        <p class="hero-sub">Compare nearby hospitals or standalone labs, book home blood collection when available, or pick a direct in-lab or hospital visit. Everything is synced back to your patient dashboard.</p>
        <div class="stat-stack">
          <div class="stat">
            <small>Home pickup</small>
            <strong>45 mins</strong>
            <span class="muted">Partner phlebotomists on map</span>
          </div>
          <div class="stat">
            <small>Radiology slots</small>
            <strong>Today & Tomorrow</strong>
            <span class="muted">MRI, CT, USG, CBCT</span>
          </div>
          <div class="stat">
            <small>Dashboard sync</small>
            <strong>Auto</strong>
            <span class="muted">Reports land in Labs</span>
          </div>
        </div>
        <div class="hero-actions">
          <a class="badge primary" href="#booking">Book blood pickup</a>
          <a class="badge" href="#radiology-board">Plan radiology</a>
          <a class="badge ghost" href="patient-dashboard.html">Open patient dashboard</a>
        </div>
      </div>
      <div class="card sync-card">
        <div class="pill-row">
          <span class="pill ghost">VOKA glass UI</span>
          <span class="pill">Live status</span>
          <span class="pill">Synced</span>
        </div>
        <h3>Patient dashboard mapping</h3>
        <p class="section-sub">Bookings, ETA, and reports reflect instantly inside <strong>Dashboard ‚Üí Labs</strong>. Home visit assignments, hospital directions, and payment links follow you.</p>
        <div class="sync-grid">
          <div>
            <p class="muted">Current profile</p>
            <div class="signal">Hydration steady ¬∑ CBC clean ¬∑ LFT green</div>
          </div>
          <div>
            <p class="muted">Next visit</p>
            <div class="signal accent">USG Pelvis ‚Äî today, VOKA Imaging Hub</div>
          </div>
        </div>
        <div class="flex-row">
          <a class="badge primary" href="patient-dashboard.html">View in dashboard</a>
          <button class="badge" type="button">Share status</button>
        </div>
      </div>
    </section>

    <section id="labs-finder" class="section">
      <header class="finder-head">
        <div>
          <p class="chip">Upgraded workflows</p>
          <h2 class="section-title">Find a lab, home pickup, or hospital slot</h2>
          <p class="section-sub">Search by name, city, visit mode, and availability. These filters mirror to <strong>Dashboard ‚Üí Labs</strong> so you can resume later.</p>
        </div>
        <div class="pill-row">
          <span class="pill">Mapped to dashboard</span>
          <span class="pill ghost">Live ETA</span>
          <span class="pill">Home visit aware</span>
        </div>
      </header>

      <div class="location-bar card">
        <div class="location-meta">
          <p class="muted">Live location</p>
          <div class="location-status" id="locationStatus">Using saved preference ¬∑ nearest first</div>
        </div>
        <div class="location-actions">
          <button class="badge" id="locateMe" type="button">Use my location</button>
          <span class="pill ghost" id="cityHint">City: Auto</span>
          <span class="pill">Synced to dashboard</span>
        </div>
      </div>

      <div class="filter-card card">
        <div class="filter-grid">
          <label>Search labs or tests
            <input id="labSearch" type="search" placeholder="CBC, Apollo, MRI, USG" />
          </label>
          <label>City
            <select id="labCity">
              <option value="">All</option>
              <option>Mumbai</option>
              <option>Delhi</option>
              <option>Bengaluru</option>
              <option>Hyderabad</option>
              <option>Chennai</option>
            </select>
          </label>
          <label>Type
            <select id="labType">
              <option value="">Any</option>
              <option value="blood">Blood / Pathology</option>
              <option value="radiology">Radiology / Imaging</option>
            </select>
          </label>
          <label>Sort
            <select id="labSort">
              <option value="nearest">Nearest</option>
              <option value="az">A‚ÄìZ</option>
            </select>
          </label>
        </div>
        <div class="filter-actions">
          <label class="pill switcher">
            <input id="homeOnlyToggle" type="checkbox" /> Home visit only
          </label>
          <label class="pill switcher ghost">
            <input id="openSlotToggle" type="checkbox" /> Show only with open slots
          </label>
          <span class="inline-meta" id="labStatus">Loading labs‚Ä¶</span>
          <button class="badge" id="syncFilters" type="button">Sync filters to dashboard</button>
        </div>
      </div>

      <div class="results-grid zomato-grid" id="labResults" aria-live="polite"></div>
    </section>

    <section class="section labs-actions">
      <header>
        <p class="chip">Workflows</p>
        <h2 class="section-title">Home visit or direct hospital visit</h2>
        <p class="section-sub">Pick how you want to give a sample; the flow adapts to phlebotomist routes or hospital counters.</p>
      </header>
      <div class="lab-action-grid">
        <div class="action-card">
          <div class="pill">Home visit</div>
          <h3>Blood pickup at home</h3>
          <p class="muted">Track the assigned phlebotomist, collection kit QR, and payment link. Works best for CBC, KFT, LFT, HbA1c.</p>
          <div class="action-footer">
            <span class="pill ghost">ETA 45 mins</span>
            <button class="badge primary" type="button">Request pickup</button>
          </div>
        </div>
        <div class="action-card">
          <div class="pill ghost">Hospital / Lab counter</div>
          <h3>Direct visit to lab</h3>
          <p class="muted">Book a slot at hospitals or stand-alone labs, generate a QR for quick check-in, and sync results to the dashboard automatically.</p>
          <div class="action-footer">
            <span class="pill">Queue <strong>Light</strong></span>
            <button class="badge" type="button">Find slot</button>
          </div>
        </div>
        <div class="action-card">
          <div class="pill ghost">Radiology</div>
          <h3>Imaging schedule</h3>
          <p class="muted">MRI, CT, USG, CBCT with hospital directions and prep checklists. Add driver details for transport if needed.</p>
          <div class="action-footer">
            <span class="pill">Today & Tomorrow</span>
            <button class="badge" type="button">Plan imaging</button>
          </div>
        </div>
      </div>
    </section>

    <section id="booking" class="section booking-shell">
      <header>
        <p class="chip">Booking cockpit</p>
        <h2 class="section-title">Book labs with one view</h2>
        <p class="section-sub">Filter by city, visit type, and slot; saved preferences mirror to the patient dashboard.</p>
      </header>
      <div class="booking-grid card">
        <div class="booking-form">
          <div class="form-row">
            <label class="pill switcher"> <input type="radio" name="visit_mode" checked> Home blood collection </label>
            <label class="pill switcher ghost"> <input type="radio" name="visit_mode"> Visit hospital / lab </label>
          </div>
          <div class="form-row">
            <label>City
              <select>
                <option>Mumbai</option>
                <option>Delhi</option>
                <option>Bengaluru</option>
                <option>Hyderabad</option>
                <option>Chennai</option>
              </select>
            </label>
            <label>Area / Locality
              <input type="text" placeholder="Andheri East, Powai, Koramangala" />
            </label>
          </div>
          <div class="form-row">
            <label>Test type
              <select>
                <option>Blood (CBC, LFT, KFT, HbA1c)</option>
                <option>Radiology (USG, MRI, CT)</option>
                <option>Health package</option>
              </select>
            </label>
            <label>Date & Time
              <div class="input-group">
                <input type="date" />
                <input type="time" />
              </div>
            </label>
          </div>
          <div class="form-row">
            <label>Preferred lab
              <input type="text" placeholder="Apollo, SRL, Thyrocare" />
            </label>
            <label>Notes
              <input type="text" placeholder="Fasting, wheelchair, contrast allergy" />
            </label>
          </div>
          <div class="form-row">
            <button class="badge primary" type="button">Confirm & sync</button>
            <button class="badge" type="button">Save preference to dashboard</button>
          </div>
        </div>
        <div class="booking-summary">
          <div class="summary-block">
            <p class="muted">Pinned tests</p>
            <h3>CBC + LFT + HbA1c</h3>
            <p class="notice">Home visit with sterile kit. Payment link shared after confirmation.</p>
          </div>
          <div class="summary-block">
            <p class="muted">Radiology</p>
            <div class="pill-row">
              <span class="pill">USG Pelvis</span>
              <span class="pill">MRI Spine</span>
              <span class="pill ghost">CT Head</span>
            </div>
            <p class="muted">Directions and prep steps show inside the patient dashboard.</p>
          </div>
          <div class="summary-block">
            <p class="muted">Sync destination</p>
            <div class="signal">Dashboard ‚Üí Labs ‚Üí Upcoming</div>
          </div>
        </div>
      </div>
    </section>

    <section class="section home-visit-board">
      <header>
        <p class="chip">Home visit blood collection</p>
        <h2 class="section-title">Live assignment</h2>
        <p class="section-sub">View phlebotomist routing, sample handling, and ETA. The same view stays pinned inside the dashboard.</p>
      </header>
      <div class="home-grid">
        <div class="card">
          <div class="pill-row">
            <span class="pill">CBC + HbA1c</span>
            <span class="pill ghost">Fasting</span>
          </div>
          <h3>Priya ‚Äî assigned</h3>
          <p class="muted">On the way ‚Ä¢ sanitized kit ‚Ä¢ payment link ready</p>
          <ul class="steps">
            <li>üìç Pickup route locked ‚Äî ETA 35 mins</li>
            <li>üßä Sample storage confirmed</li>
            <li>üì± WhatsApp + Dashboard notifications enabled</li>
          </ul>
        </div>
        <div class="card">
          <div class="pill-row">
            <span class="pill">LFT + KFT</span>
            <span class="pill ghost">Non-fasting</span>
          </div>
          <h3>Backup partner</h3>
          <p class="muted">If the first route fails, we auto-assign another partner and keep your dashboard slot intact.</p>
          <div class="notice">Live tracking mirrored to Dashboard ‚Üí Labs ‚Üí In progress</div>
        </div>
      </div>
    </section>

    <section id="radiology-board" class="section">
      <header>
        <p class="chip">Radiology board</p>
        <h2 class="section-title">Hospitals & slots</h2>
        <p class="section-sub">Prep steps and reports sync automatically. Status updates reuse the same board on your dashboard.</p>
      </header>
      <div class="rad-board">
        <div class="rad-card" data-rad-study>
          <div class="rad-head">
            <div>
              <p class="muted">MRI Spine</p>
              <strong>VOKA Imaging Hub</strong>
            </div>
            <span class="chip" data-rad-status>Ready</span>
          </div>
          <div class="rad-meta">
            <span class="pill">Slot: Today</span>
            <span class="pill ghost" data-rad-eta>Today</span>
            <span class="pill">Sedation ready</span>
          </div>
        </div>
        <div class="rad-card" data-rad-study>
          <div class="rad-head">
            <div>
              <p class="muted">USG Pelvis</p>
              <strong>Apollo Diagnostics</strong>
            </div>
            <span class="chip" data-rad-status>Scheduled</span>
          </div>
          <div class="rad-meta">
            <span class="pill">Slot: Today</span>
            <span class="pill ghost" data-rad-eta>Today</span>
            <span class="pill">Prep: Full bladder</span>
          </div>
        </div>
        <div class="rad-card" data-rad-study>
          <div class="rad-head">
            <div>
              <p class="muted">CT Head</p>
              <strong>City Multi-Slice CT</strong>
            </div>
            <span class="chip" data-rad-status>Pending upload</span>
          </div>
          <div class="rad-meta">
            <span class="pill">Slot: Tomorrow</span>
            <span class="pill ghost" data-rad-eta>Tomorrow</span>
            <span class="pill">Contrast ready</span>
          </div>
        </div>
      </div>
    </section>

    <section class="section section-slab">
      <header>
        <p class="chip">Report sync</p>
        <h2 class="section-title">Everything lands in dashboard</h2>
        <p class="section-sub">Labs, blood panels, radiology DICOM links, and payments show in one place. Click below to jump there.</p>
      </header>
      <div class="flex-row">
        <div class="notice">Dashboard ‚Üí Labs ‚Üí Reports will mirror every booking made here. You can share the dashboard view with your doctor or family.</div>
        <a class="badge primary" href="patient-dashboard.html">Open dashboard</a>
      </div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 HealthFlo ‚Äî Labs</p>
  </footer>

  <script src="js/patient-os.js"></script>
  <script>
    const labData = [
      { name: 'Apollo Diagnostics', city: 'Mumbai', area: 'Andheri East', lat: 19.119, lng: 72.846, distance: 2.1, homeVisit: true, type: ['blood', 'radiology'], slot: 'Today ‚Ä¢ 4:30 PM', tests: [
        { name: 'CBC', price: 350, type: 'blood' },
        { name: 'HbA1c', price: 520, type: 'blood' },
        { name: 'LFT', price: 900, type: 'blood' },
        { name: 'USG Abdomen', price: 1400, type: 'radiology' }
      ], open: true, rating: 4.7, img: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?q=80&auto=format&fit=crop&w=1200' },
      { name: 'SRL Diagnostics', city: 'Delhi', area: 'Dwarka', lat: 28.592, lng: 77.046, distance: 4.6, homeVisit: false, type: ['blood'], slot: 'Today ‚Ä¢ Counter', tests: [
        { name: 'CBC', price: 340, type: 'blood' },
        { name: 'Thyroid Profile', price: 650, type: 'blood' },
        { name: 'Cardiac markers', price: 1200, type: 'blood' }
      ], open: true, rating: 4.6, img: 'https://images.unsplash.com/photo-1526256262350-7da7584cf5eb?q=80&auto=format&fit=crop&w=1200' },
      { name: 'VOKA Imaging Hub', city: 'Mumbai', area: 'Four Bungalows', lat: 19.134, lng: 72.833, distance: 3.0, homeVisit: false, type: ['radiology'], slot: 'Today ‚Ä¢ MRI/CT', tests: [
        { name: 'MRI Spine', price: 5200, type: 'radiology' },
        { name: 'CT Head', price: 2500, type: 'radiology' },
        { name: 'USG Pelvis', price: 1400, type: 'radiology' }
      ], open: true, rating: 4.8, img: 'https://images.unsplash.com/photo-1586773860418-d37222d8fce3?q=80&auto=format&fit=crop&w=1200' },
      { name: 'Aster Labs', city: 'Bengaluru', area: 'Whitefield', lat: 12.969, lng: 77.749, distance: 5.4, homeVisit: true, type: ['blood'], slot: 'Tomorrow ‚Ä¢ 9:15 AM', tests: [
        { name: 'CBC', price: 330, type: 'blood' },
        { name: 'KFT', price: 900, type: 'blood' },
        { name: 'LFT', price: 880, type: 'blood' }
      ], open: false, rating: 4.5, img: 'https://images.unsplash.com/photo-1582719478145-bf0f1f6b68ff?q=80&auto=format&fit=crop&w=1200' },
      { name: 'Metropolis Lab', city: 'Delhi', area: 'Preet Vihar', lat: 28.636, lng: 77.289, distance: 3.2, homeVisit: true, type: ['blood', 'radiology'], slot: 'Today ‚Ä¢ 6:00 PM', tests: [
        { name: 'LFT', price: 920, type: 'blood' },
        { name: 'KFT', price: 910, type: 'blood' },
        { name: 'X-Ray Chest', price: 450, type: 'radiology' }
      ], open: true, rating: 4.4, img: 'https://images.unsplash.com/photo-1504439468489-c8920d796a29?q=80&auto=format&fit=crop&w=1200' },
      { name: 'Healthians', city: 'Hyderabad', area: 'Banjara Hills', lat: 17.416, lng: 78.448, distance: 6.1, homeVisit: true, type: ['blood'], slot: 'Today ‚Ä¢ 5:00 PM', tests: [
        { name: 'CBC', price: 320, type: 'blood' },
        { name: 'Lipid Profile', price: 900, type: 'blood' },
        { name: 'Vitamin D', price: 1200, type: 'blood' }
      ], open: true, rating: 4.6, img: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?q=80&auto=format&fit=crop&w=1200' }
    ];

    const labResults = document.getElementById('labResults');
    const labSearch = document.getElementById('labSearch');
    const labCity = document.getElementById('labCity');
    const labType = document.getElementById('labType');
    const labSort = document.getElementById('labSort');
    const homeOnlyToggle = document.getElementById('homeOnlyToggle');
    const openSlotToggle = document.getElementById('openSlotToggle');
    const labStatus = document.getElementById('labStatus');
    const syncFilters = document.getElementById('syncFilters');
    const locateMe = document.getElementById('locateMe');
    const locationStatus = document.getElementById('locationStatus');
    const cityHint = document.getElementById('cityHint');

    const deg2rad = (d) => d * (Math.PI / 180);
    const haversineKm = (a, b) => {
      const R = 6371;
      const dLat = deg2rad(b.lat - a.lat);
      const dLon = deg2rad(b.lng - a.lng);
      const lat1 = deg2rad(a.lat);
      const lat2 = deg2rad(b.lat);
      const h = Math.sin(dLat / 2) ** 2 + Math.cos(lat1) * Math.cos(lat2) * (Math.sin(dLon / 2) ** 2);
      return R * (2 * Math.asin(Math.sqrt(h)));
    };

    let userLoc = null;

    function formatDistance(lab) {
      if (userLoc) {
        return haversineKm(userLoc, { lat: lab.lat, lng: lab.lng }).toFixed(1);
      }
      return lab.distance || '‚Äî';
    }

    function renderTests(tests, type) {
      return tests
        .filter(t => !type || t.type === type)
        .slice(0, 4)
        .map(t => `<span class="test-chip">${t.name} <strong>‚Çπ${t.price}</strong></span>`)
        .join('');
    }

    function renderLabs() {
      if (!labResults) return;
      const query = (labSearch?.value || '').trim().toLowerCase();
      const city = labCity?.value || '';
      const type = labType?.value || '';
      const homeOnly = homeOnlyToggle?.checked;
      const openOnly = openSlotToggle?.checked;

      let filtered = labData.filter(lab => {
        if (city && lab.city !== city) return false;
        if (type && !lab.type.includes(type)) return false;
        if (homeOnly && !lab.homeVisit) return false;
        if (openOnly && !lab.open) return false;
        if (query) {
          const blob = `${lab.name} ${lab.city} ${lab.area} ${lab.tests.map(t => t.name).join(' ')}`.toLowerCase();
          if (!blob.includes(query)) return false;
        }
        return true;
      });

      filtered = filtered.map(lab => ({ ...lab, distanceCalc: formatDistance(lab) }));

      if ((labSort?.value || '') === 'az') {
        filtered = filtered.sort((a, b) => a.name.localeCompare(b.name));
      } else {
        filtered = filtered.sort((a, b) => {
          const distA = parseFloat(a.distanceCalc);
          const distB = parseFloat(b.distanceCalc);
          return (isNaN(distA) ? 9999 : distA) - (isNaN(distB) ? 9999 : distB);
        });
      }

      labResults.innerHTML = '';
      filtered.forEach(lab => {
        const card = document.createElement('article');
        card.className = 'lab-card zomato-card';
        card.innerHTML = `
          <div class="lab-img" style="background-image:url('${lab.img}')">
            <div class="lab-badge-row">
              <span class="pill ${lab.homeVisit ? '' : 'ghost'}">${lab.homeVisit ? 'Home visit' : 'Visit lab'}</span>
              <span class="pill ghost">${lab.open ? 'Open slots' : 'Waitlist'}</span>
            </div>
            <div class="lab-rating">${lab.rating.toFixed(1)}‚òÖ</div>
          </div>
          <div class="lab-body">
            <div class="lab-head">
              <div>
                <h3>${lab.name}</h3>
                <p class="muted">${lab.area} ‚Ä¢ ${lab.city}</p>
              </div>
              <span class="pill">${lab.distanceCalc} km</span>
            </div>
            <p class="notice">${lab.tests[0]?.name || ''} starts at ‚Çπ${lab.tests[0]?.price} ‚Äî ${lab.slot}. Synced with dashboard.</p>
            <div class="lab-meta">
              <span class="tag">${lab.type.includes('blood') ? 'Blood' : ''}${lab.type.length === 2 ? ' & ' : ''}${lab.type.includes('radiology') ? 'Radiology' : ''}</span>
              <span class="tag">${lab.slot}</span>
              <span class="tag">Dashboard link</span>
            </div>
            <div class="lab-tests">${renderTests(lab.tests, type)}</div>
            <div class="card-actions">
              <button class="badge primary" type="button">Book</button>
              <a class="badge" href="https://www.google.com/maps?q=${encodeURIComponent(lab.name)}@${lab.lat},${lab.lng}" target="_blank" rel="noopener">Directions</a>
              <button class="badge ghost" type="button">View tests</button>
            </div>
          </div>
        `;
        labResults.appendChild(card);
      });

      if (labStatus) {
        labStatus.textContent = `${filtered.length} labs ready ¬∑ filters mirrored to dashboard`;
      }
    }

    [labSearch, labCity, labType, labSort, homeOnlyToggle, openSlotToggle].forEach(el => {
      el?.addEventListener('input', renderLabs);
      el?.addEventListener('change', renderLabs);
    });

    syncFilters?.addEventListener('click', () => {
      if (!labStatus) return;
      labStatus.textContent = 'Filters synced to dashboard ‚úî';
      labStatus.classList.add('accent-text');
      setTimeout(() => labStatus.classList.remove('accent-text'), 1800);
    });

    locateMe?.addEventListener('click', () => {
      if (!navigator.geolocation) {
        locationStatus.textContent = 'Geolocation not supported on this device';
        return;
      }
      locationStatus.textContent = 'Detecting location‚Ä¶';
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          userLoc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          locationStatus.textContent = 'Using your live location';
          cityHint.textContent = 'City: Auto (nearest)';
          renderLabs();
        },
        () => {
          locationStatus.textContent = 'Unable to fetch location ‚Äî using saved preference';
        },
        { enableHighAccuracy: true, timeout: 8000 }
      );
    });

    renderLabs();
  </script>
</body>
</html>
