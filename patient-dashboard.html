<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Health flo OS - NEO 3.0 (Pro)</title>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Reverted to r128 for stability with global script tags. Newer versions dropped examples/js support. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <style>
        :root {
            /* Theme Variables */
            --bg-radial: radial-gradient(circle at 20% 30%, #506176 0%, #1a1f2b 55%, #0E121B 100%);
            
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: blur(24px);
            
            --text-white: #ffffff;
            --text-muted: #94a3b8;

            /* Component Specifics */
            --sidebar-bg: rgba(255, 255, 255, 0.02);
            --card-hover-bg: rgba(30, 35, 45, 0.9);
            --pill-active-text: #ffffff;

            /* Status Colors */
            --color-blue: #3b82f6;
            --color-cyan: #06b6d4;
            --color-yellow: #f59e0b;
            --color-red: #ef4444;
            --color-green: #10b981;
            
            --accent-blue: #3b82f6;
            --card-bg: rgba(22, 28, 38, 0.6);
            --card-border: rgba(255, 255, 255, 0.05);
            --card-active-bg: linear-gradient(135deg, rgba(30, 58, 138, 0.6) 0%, rgba(15, 23, 42, 0.8) 100%);
        }

        body.theme-white {
            /* High Contrast Light Theme */
            --bg-radial: radial-gradient(circle at 20% 30%, #f0f4f8 0%, #e2e8f0 55%, #cbd5e1 100%);
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(51, 65, 85, 0.15);
            --text-white: #0f172a;
            --text-muted: #475569;
            --sidebar-bg: rgba(255, 255, 255, 0.5);
            --card-hover-bg: #ffffff;
            --pill-active-text: #1e3a8a;
            --card-bg: rgba(255, 255, 255, 0.85);
            --card-border: rgba(51, 65, 85, 0.1);
            --card-active-bg: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%);
        }

        /* RESET */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Plus Jakarta Sans', sans-serif; -webkit-font-smoothing: antialiased; }
        
        /* CUSTOM SCROLLBARS */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-blue); }
        
        body {
            height: 100vh; width: 100vw;
            background: var(--bg-radial);
            overflow: hidden; user-select: none;
            color: var(--text-white);
            transition: color 0.3s, background 0.3s;
        }

        /* BOOT SCREEN */
        .boot-screen {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--color-blue); font-family: 'Courier New', monospace;
            transition: opacity 0.8s ease-out;
        }
        .boot-loader {
            width: 200px; height: 2px; background: rgba(59, 130, 246, 0.3); margin-top: 20px;
            position: relative; overflow: hidden;
        }
        .boot-bar {
            position: absolute; left: 0; top: 0; height: 100%; width: 0%;
            background: var(--color-blue); box-shadow: 0 0 10px var(--color-blue);
            animation: loadBar 2.5s ease-in-out forwards;
        }
        .boot-text { font-size: 12px; margin-top: 10px; letter-spacing: 2px; opacity: 0.8; }
        .boot-cta {
            margin-top: 18px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            border-radius: 12px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            color: #e5e7eb;
            cursor: pointer;
            font-size: 12px;
        }
        .boot-cta i { font-size: 14px; }
        .boot-screen.hide-fast { opacity: 0; pointer-events: none; }
        @keyframes loadBar { 0% { width: 0%; } 40% { width: 30%; } 80% { width: 90%; } 100% { width: 100%; } }

        /* LAYOUT CONTAINER */
        .app-container {
            width: 100vw; height: 100vh;
            background: transparent;
            display: flex; flex-direction: column; overflow: hidden; position: relative;
            opacity: 0; transition: opacity 1s;
        }

        /* BROWSER BAR */
        .browser-bar {
            height: 50px; display: flex; align-items: center; padding: 0 24px; gap: 20px;
            border-bottom: 1px solid var(--glass-border); 
            background: rgba(0,0,0,0.2); 
            backdrop-filter: blur(10px);
            z-index: 20;
            flex-shrink: 0;
        }
        .window-controls { display: flex; gap: 8px; margin-right: 12px; }
        .window-dot { width: 12px; height: 12px; border-radius: 50%; opacity: 0.8; }
        .branding-right { margin-left: auto; font-weight: 700; color: var(--text-white); letter-spacing: 1px; font-size: 13px; opacity: 0.8; display: flex; align-items: center; gap: 10px; }
        .branding-right span { color: var(--color-blue); text-shadow: 0 0 15px rgba(59, 130, 246, 0.6); }

        /* DASHBOARD BODY */
        .dashboard-body { flex: 1; display: flex; overflow: hidden; position: relative; }

        /* SIDEBAR */
        .sidebar {
            width: 280px; display: flex; flex-direction: column; align-items: stretch; padding: 24px; gap: 16px;
            border-right: 1px solid var(--glass-border);
            z-index: 10;
            background: var(--sidebar-bg);
            backdrop-filter: var(--glass-blur);
            flex-shrink: 0;
        }
        .sidebar .menu-stack { display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: stretch; }
        .sidebar .logo { font-size: 28px; }
        .sidebar-top { display: flex; flex-direction: column; gap: 10px; }
        .version-pill { align-self: flex-start; padding: 8px 12px; border-radius: 999px; border: 1px solid var(--glass-border); background: rgba(59,130,246,0.12); color: var(--text-white); font-size: 12px; font-weight: 700; display: inline-flex; align-items: center; gap: 8px; }
        .patient-quick { background: rgba(255,255,255,0.04); border: 1px solid var(--glass-border); border-radius: 14px; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
        .patient-quick .name { font-weight: 800; font-size: 16px; }
        .pill-row { display: flex; gap: 6px; flex-wrap: wrap; }
        .pill { padding: 6px 10px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.15); font-size: 11px; color: var(--text-muted); display: inline-flex; align-items: center; gap: 6px; }
        .pill i { color: var(--accent-blue); }
        .nav-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin: 4px 0; }
        .sidebar-nav { display: flex; flex-direction: column; gap: 8px; }
        .nav-link { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 12px; color: var(--text-white); text-decoration: none; border: 1px solid transparent; font-weight: 600; font-size: 13px; }
        .nav-link i { color: var(--accent-blue); }
        .nav-link.active, .nav-link:hover { background: rgba(59,130,246,0.12); border-color: rgba(59,130,246,0.3); }
        .nav-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; }
        .nav-chip-tile { padding: 12px; border-radius: 14px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.04); color: var(--text-white); text-decoration: none; display: flex; flex-direction: column; gap: 8px; font-size: 12px; }
        .nav-chip-tile strong { font-size: 13px; }
        .family-watch { padding: 12px; border-radius: 14px; border: 1px solid var(--glass-border); background: rgba(16,185,129,0.08); color: var(--text-white); display: flex; flex-direction: column; gap: 6px; font-size: 12px; }
        .family-watch .avatars { display: flex; gap: 6px; }
        .family-watch .avatar { width: 28px; height: 28px; border-radius: 50%; background: rgba(255,255,255,0.2); display: grid; place-items: center; font-size: 12px; font-weight: 800; }
        .sidebar-utilities {
            width: 100%; display: flex; flex-direction: column; gap: 10px; align-items: stretch;
        }
        .sidebar-utilities .label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; padding: 0 4px; }
        .sidebar-utilities button {
            width: 100%; display: flex; flex-direction: row; gap: 8px; align-items: center; justify-content: flex-start;
            background: rgba(255,255,255,0.04); border: 1px solid var(--glass-border); color: var(--text-white);
            border-radius: 12px; padding: 12px 10px; cursor: pointer; transition: 0.3s; font-weight: 700; font-size: 12px;
        }
        .sidebar-utilities button:hover { border-color: rgba(59,130,246,0.5); box-shadow: 0 10px 20px rgba(0,0,0,0.2); transform: translateY(-2px); }
        .sidebar-utilities i { font-size: 18px; color: var(--color-blue); }
        .sidebar-utilities span { font-size: 12px; font-weight: 700; color: var(--text-white); }
        .bottom-nav {
            display: none;
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(12px);
            border-top: 1px solid var(--glass-border);
            padding: 10px 18px;
            z-index: 50;
        }
        .bottom-nav .nav-items { display: flex; justify-content: space-between; align-items: center; }
        .bottom-nav button {
            background: transparent; border: none; color: var(--text-white); font-size: 22px; width: 20%; padding: 10px 0;
        }
        .mobile-link-strip {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-top: 8px;
            margin-top: 8px;
            border-top: 1px solid var(--glass-border);
        }
        .mobile-link-strip a {
            white-space: nowrap;
            padding: 8px 10px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.05);
            color: var(--text-white);
            font-size: 12px;
            text-decoration: none;
        }
        .logo { font-weight: 800; color: var(--text-white); font-size: 24px; letter-spacing: -1px; margin-bottom: 12px; }
        .logo span { color: var(--color-blue); }
        .menu-item {
            width: 44px; height: 44px; border-radius: 14px; display: flex; justify-content: center; align-items: center;
            color: var(--text-muted); font-size: 20px; cursor: pointer; transition: 0.3s; border: 1px solid transparent;
        }
        .menu-item:hover { color: var(--text-white); background: rgba(125, 125, 125, 0.1); }
        .menu-item.active { 
            background: rgba(59, 130, 246, 0.1); 
            color: var(--color-blue); 
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2); 
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        /* MAIN GRID - COMPACT */
        .main-content {
            flex: 1; padding: 20px 30px;
            display: flex;
            flex-direction: column;
            gap: 18px; overflow-y: auto; position: relative;
        }

        .main-columns {
            display: grid;
            grid-template-columns: 1.1fr 1fr;
            gap: 18px;
            align-items: start;
        }

        /* HEADER */
        .header-section {
            grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 5px; z-index: 5;
        }
        .header-left { display: flex; flex-direction: column; gap: 8px; }
        .top-toggles { display: flex; gap: 10px; }
        .toggle-pill {
            padding: 6px 20px; border-radius: 100px; font-size: 12px; font-weight: 500;
            color: var(--text-muted); background: rgba(125, 125, 125, 0.1); border: 1px solid var(--glass-border);
            cursor: pointer; transition: 0.3s; backdrop-filter: blur(10px);
        }
        .page-nav {
            display: flex; gap: 8px; flex-wrap: wrap; margin-top: 4px;
        }
        .page-nav a {
            display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px;
            border-radius: 10px; border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.04); color: var(--text-white);
            font-size: 11px; text-decoration: none; transition: 0.2s; backdrop-filter: blur(10px);
        }
        .page-nav a:hover { border-color: rgba(59, 130, 246, 0.4); color: var(--color-blue); }
        .page-nav a .ph { font-size: 14px; }

        .link-row {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .nav-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.04);
            color: var(--text-white);
            font-size: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: 0.2s;
        }
        .nav-chip i { font-size: 16px; }
        .nav-chip:hover {
            color: var(--color-blue);
            border-color: rgba(59,130,246,0.4);
            box-shadow: 0 10px 30px -12px rgba(59,130,246,0.35);
        }
        .toggle-pill.active {
            background: rgba(59, 130, 246, 0.2); color: var(--pill-active-text); border-color: rgba(59, 130, 246, 0.5);
            display: flex; align-items: center; gap: 8px; box-shadow: 0 0 15px rgba(59, 130, 246, 0.15);
        }
        .active-dot { width: 6px; height: 6px; background: var(--color-blue); border-radius: 50%; box-shadow: 0 0 10px var(--color-blue); }

        .page-title h2 { font-size: 16px; color: var(--color-blue); margin-bottom: 2px; font-weight: 600; letter-spacing: 0.5px; }
        .page-title h1 { font-size: 42px; font-weight: 700; color: var(--text-white); line-height: 1; letter-spacing: -1.5px; }
        .page-title h1 span { font-weight: 300; opacity: 0.8; }

        .theme-toggle {
            padding: 6px 12px; border-radius: 10px; border: 1px solid var(--glass-border);
            background: rgba(125, 125, 125, 0.1); color: var(--text-white); cursor: pointer; font-weight: 700; font-size: 11px;
        }

        /* LEFT PANEL (3D + ORGANS) */
        .left-panel-container {
            display: grid;
            grid-template-rows: auto auto;
            gap: 12px;
            position: relative;
        }

        /* 3D STAGE */
        .heart-stage {
            min-height: 320px;
            max-height: 420px;
            position: relative;
            display: flex; justify-content: center; align-items: center;
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            background: rgba(0,0,0,0.1);
            overflow: hidden;
            padding: 12px;
        }
        #model-3d-container {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1;
            opacity: 0; animation: fadeIn 1.5s ease-out forwards;
        }

        /* Animated Rings Background */
        .rings {
            position: absolute; width: 500px; height: 500px; border-radius: 50%;
            border: 1px solid var(--glass-border); 
            background: radial-gradient(circle, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
            z-index: 0; animation: spin 60s linear infinite;
        }
        .rings::before {
            content: ''; position: absolute; top: 40px; left: 40px; right: 40px; bottom: 40px;
            border-radius: 50%; border: 1px dashed var(--glass-border);
            animation: spinReverse 40s linear infinite;
        }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes spinReverse { 100% { transform: rotate(-360deg); } }
        @keyframes fadeIn { to { opacity: 1; } }

        .scanner-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--color-cyan), transparent);
            box-shadow: 0 0 20px var(--color-cyan);
            animation: scan-down 3s ease-in-out infinite; z-index: 2; opacity: 0.3;
            pointer-events: none;
        }
        @keyframes scan-down { 0% { top: 5%; opacity: 0; } 50% { opacity: 0.6; } 100% { top: 95%; opacity: 0; } }

        /* ORGAN TRAY */
        .organ-tray-wrapper {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 18px;
            padding: 12px;
            z-index: 10;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .section-header.mini { font-size: 10px; margin-bottom: 8px; opacity: 0.7; }

        .organ-tray { 
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        /* RELOCATED SIDEBAR CONTENT */
        .relocated-hub {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 18px;
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            backdrop-filter: blur(20px);
        }
        .relocated-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .relocated-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 10px;
        }
        .relocated-card {
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            padding: 12px;
            background: rgba(255,255,255,0.03);
        }
        .nav-card .sidebar-nav { gap: 6px; }
        .nav-card .nav-link { width: 100%; }
        .nav-card .nav-grid { margin-top: 10px; }
        .health-stack { display: flex; flex-direction: column; gap: 8px; }

        .organ-item {
            width: 44px; height: 44px;
            background: rgba(125,125,125,0.05);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(15px);
            border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative; cursor: pointer; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            flex-shrink: 0;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
        .premium-icon {
            position: absolute; top: 3px; right: 3px;
            width: 10px; height: 10px; border-radius: 6px;
            background: linear-gradient(135deg, #ffd166, #f97316);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.35);
        }
        .premium-icon i { font-size: 6px; color: #1f2937; }
        .organ-item:hover {
            background: rgba(125,125,125,0.1);
            transform: translateY(-2px);
            border-color: rgba(59, 130, 246, 0.3);
        }
        .organ-item i, .organ-item svg { font-size: 20px; color: var(--text-muted); transition: 0.3s; margin-bottom: 0; fill: none; stroke: currentColor; stroke-width: 1.5; width: 22px; height: 22px; }
        
        .organ-item.selected {
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.15), rgba(0,0,0,0));
            border: 1px solid var(--color-blue);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3), inset 0 0 20px rgba(59, 130, 246, 0.1);
        }
        .organ-item.selected i, .organ-item.selected svg {
            color: var(--text-white); stroke: var(--text-white); filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.8)); transform: scale(1.1);
        }
        
        .organ-name-mini { display: none; } 

        .organ-label {
            position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
            background: #ffffff; color: #000; font-size: 9px; font-weight: 800;
            padding: 2px 6px; border-radius: 100px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none; white-space: nowrap; z-index: 20;
        }

        /* RIGHT PANEL (VITALS + SCHEDULE) */
        .right-panel-container {
            display: grid;
            grid-template-rows: auto auto 1fr;
            gap: 12px;
            height: 100%;
        }

        .insight-stack {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 12px;
        }.cards-grid { display: grid; grid-template-columns: 1fr 1fr; grid-auto-rows: 1fr; gap: 10px; }

        .floating-stat {
            background: var(--card-bg); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 16px;
            padding: 12px 14px; width: 100%; z-index: 10;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; gap: 6px;
        }
        .live-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 6px; background: rgba(239, 68, 68, 0.15); color: #ef4444; border-radius: 4px; font-size: 9px; font-weight: 700; letter-spacing: 0.5px; }
        .live-dot { width: 5px; height: 5px; background: #ef4444; border-radius: 50%; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* READINESS CARD */
        .readiness-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(0,0,0,0));
            border-color: rgba(16, 185, 129, 0.3);
        }
        .progress-bar-bg { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; margin-top: 4px; }
        .progress-bar-fill { height: 100%; background: #10b981; width: 85%; border-radius: 10px; box-shadow: 0 0 10px #10b981; transition: width 1s; }

        /* STATS GRID */
        .section-header { font-size: 12px; font-weight: 700; color: var(--color-blue); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        .blue-dot { width: 5px; height: 5px; background: var(--color-blue); border-radius: 50%; box-shadow: 0 0 8px var(--color-blue); }

        .cards-grid { display: grid; grid-template-columns: 1fr 1fr; grid-auto-rows: 1fr; gap: 10px; }
        
        .data-card {
            background: var(--card-bg); 
            backdrop-filter: blur(18px);
            border-radius: 16px; padding: 14px;
            display: flex; flex-direction: column; justify-content: space-between;
            border: 1px solid var(--card-border); position: relative; overflow: hidden; transition: 0.3s;
            min-height: 100px;
        }
        
        .data-card:hover { 
            border-color: rgba(59, 130, 246, 0.4); 
            background: var(--card-hover-bg); 
            transform: translateY(-2px);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.15); 
        }

        /* SCANNING STATE CSS */
        .scanning-text {
            color: var(--color-blue);
            font-size: 12px; font-weight: 600; letter-spacing: 1px;
            animation: pulseText 1s infinite;
        }
        @keyframes pulseText { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }

        /* DYNAMIC CARD COLORS */
        .data-card.state-blue .card-icon { color: var(--color-blue); }
        .data-card.active-blue {
            background: var(--card-active-bg); 
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 20px 50px -20px rgba(30, 58, 138, 0.15);
        }
        .data-card.state-yellow {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(125, 125, 125, 0.05) 100%);
            border: 1px solid rgba(245, 158, 11, 0.4);
        }
        .data-card.state-yellow .card-icon { color: var(--color-yellow); }
        
        .data-card.state-red {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(125, 125, 125, 0.05) 100%);
            border: 1px solid rgba(239, 68, 68, 0.4);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.1);
        }
        .data-card.state-red .card-icon { color: var(--color-red); }

        .card-head { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px; z-index: 2; }
        .card-icon { font-size: 16px; transition: color 0.3s; }
        .card-title { font-size: 10px; color: var(--text-muted); display: block; margin-bottom: 1px; font-weight: 600; }
        .card-val { font-size: 18px; font-weight: 700; color: var(--text-white); letter-spacing: -0.5px; transition: 0.3s; }
        
        .bar-chart { display: flex; align-items: flex-end; gap: 3px; height: 30px; margin-top: auto; z-index: 2; }
        .bar { flex: 1; background: rgba(125,125,125,0.15); border-radius: 2px; transition: height 0.5s ease-in-out, background 0.3s; }
        .bar.act { background: currentColor; }
        
        .blue-square-val {
            position: absolute; right: 14px; bottom: 14px; width: 36px; height: 36px;
            background: var(--accent-blue); border-radius: 10px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; box-shadow: 0 10px 20px rgba(37, 99, 235, 0.4); z-index: 2;
        }
        
        /* SCHEDULE AREA */
        .schedule-area {
            flex: 1; /* Fill remaining height */
            background: var(--card-bg);
            backdrop-filter: blur(24px);
            border-radius: 18px; padding: 16px;
            border: 1px solid var(--glass-border); display: flex; flex-direction: column;
            gap: 10px;
        }
        .ai-panel {
            margin-top: auto; padding: 14px; background: rgba(59, 130, 246, 0.08);
            border-radius: 14px; border: 1px solid rgba(59, 130, 246, 0.2); transition: 0.3s;
            margin-bottom: 0;
        }
        .ai-panel .typing { font-style: italic; color: var(--text-muted); font-size: 11px; margin-top: 4px; display: none; }
        .ai-panel.warn { background: rgba(239, 68, 68, 0.1); border-color: var(--color-red); }
        .ai-title { font-size: 10px; font-weight: 800; color: var(--color-blue); margin-bottom: 4px; display: block; letter-spacing: 1px; }
        .ai-text { font-size: 11px; line-height: 1.4; color: var(--text-muted); }

        /* DISEASE GUIDANCE PANEL */
        .guidance-panel {
            margin-top: 10px;
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 14px;
            padding: 12px;
            display: none;
        }
        .guidance-title { color: #ef4444; font-size: 11px; font-weight: 700; margin-bottom: 6px; text-transform: uppercase; }
        .guidance-list { font-size: 10px; color: var(--text-white); list-style: none; display: flex; flex-direction: column; gap: 4px; }
        .guidance-list li { display: flex; gap: 6px; align-items: flex-start; }
        .guidance-list li::before { content: "•"; color: #ef4444; font-weight: bold; }

        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .health-card {
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.04);
        }
        .health-card h4 { margin-bottom: 6px; font-size: 14px; display: flex; align-items: center; gap: 6px; }
        .health-card p { font-size: 12px; color: var(--text-muted); }
        .badge-line { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }
        .badge-line span {
            padding: 4px 8px; border-radius: 999px; border: 1px solid var(--glass-border);
            font-size: 11px; color: var(--text-muted); background: rgba(255,255,255,0.04);
        }

        .sync-board { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px; margin-top: 10px; }
        .sync-card { border: 1px solid var(--glass-border); border-radius: 14px; padding: 12px; background: rgba(255,255,255,0.03); display: flex; flex-direction: column; gap: 6px; }
        .sync-card .title { display: flex; align-items: center; gap: 8px; font-weight: 800; font-size: 13px; }
        .sync-card .title i { color: var(--accent-blue); }
        .sync-card .desc { color: var(--text-muted); font-size: 12px; }
        .sync-card .meta { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #10b981; font-weight: 700; }
        .sync-card .meta .dot { width: 8px; height: 8px; border-radius: 50%; background: #10b981; box-shadow: 0 0 10px rgba(16,185,129,0.6); }
        .sync-card a { color: var(--accent-blue); font-weight: 700; font-size: 12px; text-decoration: none; }

        .next-checkup {
            background: rgba(125,125,125,0.05); border-radius: 14px; padding: 10px;
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 12px; color: var(--text-white); border: 1px solid var(--glass-border);
        }
        .date-nav {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
            background: rgba(0,0,0,0.05); padding: 4px; border-radius: 100px; border: 1px solid var(--glass-border);
        }
        .nav-arrow { 
            width: 22px; height: 22px; border-radius: 50%; background: rgba(125,125,125,0.1); 
            display: flex; justify-content: center; align-items: center; font-size: 11px; color: #9ca3af; cursor: pointer; transition: 0.2s;
        }
        .doc-list { display: flex; flex-direction: column; gap: 6px; flex: 1; overflow-y: auto; max-height: 120px; margin-bottom: 10px; }
        .doc-row { 
            display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 10px; 
            transition: 0.2s; cursor: pointer; border: 1px solid transparent;
        }
        .doc-row:hover { background: rgba(125,125,125,0.08); border-color: var(--glass-border); }
        .doc-img { width: 32px; height: 32px; border-radius: 8px; object-fit: cover; }
        .consult-btn {
            margin-top: 10px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; padding: 10px;
            border-radius: 100px; font-weight: 700; font-size: 12px; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            box-shadow: 0 10px 30px -5px rgba(59, 130, 246, 0.4); transition: 0.3s;
        }

        /* Sound Button */
        .sound-btn {
            position: absolute; top: 16px; left: 16px;
            width: 36px; height: 36px; border-radius: 50%;
            background: rgba(125,125,125,0.1); border: 1px solid var(--glass-border);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; z-index: 100; color: var(--text-white); transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .sound-btn:hover { background: rgba(125,125,125,0.2); transform: scale(1.05); }
        
        .sound-btn.active {
            color: var(--color-blue);
            background: rgba(59, 130, 246, 0.15);
            border-color: var(--color-blue);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }
        .sound-btn.active i {
            animation: pulseIcon 1.5s infinite;
        }
        @keyframes pulseIcon { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

        .chat-drawer {
            position: relative; width: 100%;
            background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 18px; padding: 12px;
            backdrop-filter: blur(18px); box-shadow: 0 10px 30px rgba(0,0,0,0.12); z-index: 1;
        }
        .chat-drawer h4 { margin-bottom: 8px; color: var(--text-white); display: flex; align-items: center; gap: 6px; font-size: 13px; justify-content: space-between; }
        .chat-drawer .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #10b981; box-shadow: 0 0 10px rgba(16,185,129,0.7); }
        .chat-messages { max-height: 220px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        .chat-bubble { padding: 10px 12px; border-radius: 14px; font-size: 12px; line-height: 1.4; color: var(--text-white); }
        .chat-bubble.user { background: rgba(125,125,125,0.1); align-self: flex-end; }
        .chat-bubble.bot { background: rgba(37, 99, 235, 0.15); border: 1px solid rgba(37,99,235,0.3); }
        .chat-input-row { display: flex; gap: 8px; margin-top: 8px; }
        .chat-input-row input { flex: 1; padding: 10px 12px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(125,125,125,0.05); color: var(--text-white); }
        .chat-input-row button { padding: 10px 12px; border-radius: 12px; border: none; background: var(--accent-blue); color: white; font-weight: 700; cursor: pointer; }

        .utility-launchers { position: fixed; left: 24px; bottom: 80px; display: flex; gap: 10px; z-index: 40; }
        .utility-launchers button { padding: 10px 12px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(125,125,125,0.1); color: var(--text-white); cursor: pointer; font-size: 12px; }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); display: none;
            align-items: center; justify-content: center; z-index: 60;
        }
        .modal-box {
            width: min(520px, 90vw); background: var(--card-bg); border-radius: 20px; border: 1px solid var(--card-border);
            padding: 20px; color: var(--text-white); box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .modal-header h3 { font-size: 16px; }
        .modal-body { font-size: 13px; color: var(--text-muted); display: flex; flex-direction: column; gap: 10px; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 14px; }
        .ghost-btn { background: transparent; color: var(--text-white); border: 1px solid var(--glass-border); padding: 10px 12px; border-radius: 12px; cursor: pointer; }
        .primary-btn { background: var(--accent-blue); color: white; border: none; padding: 10px 12px; border-radius: 12px; cursor: pointer; }
        .danger-btn { background: #ef4444; color: white; border: none; padding: 10px 12px; border-radius: 12px; cursor: pointer; }

        .sos-btn { position: fixed; right: 24px; bottom: 24px; width: 140px; height: 50px; border-radius: 16px; border: 1px solid rgba(239,68,68,0.3); background: rgba(239,68,68,0.12); color: var(--text-white); font-weight: 800; cursor: pointer; box-shadow: 0 10px 30px rgba(239,68,68,0.3); }
        .sos-btn.holding { background: rgba(239,68,68,0.25); }

        .file-list { display: flex; flex-direction: column; gap: 8px; }
        .file-item { padding: 10px 12px; border: 1px solid var(--glass-border); border-radius: 10px; display: flex; justify-content: space-between; align-items: center; background: rgba(125,125,125,0.05); }

        .toast { position: fixed; top: 80px; right: 24px; background: rgba(16,185,129,0.2); color: var(--text-white); padding: 10px 14px; border-radius: 12px; border: 1px solid rgba(16,185,129,0.4); display: none; z-index: 80; }

        .faceid-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); z-index: 70; }
        .faceid-box { width: 320px; height: 380px; border: 2px solid #0A84FF; border-radius: 24px; position: relative; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .faceid-scan { position: absolute; left: 20px; right: 20px; height: 3px; background: linear-gradient(90deg, transparent, #0A84FF, transparent); animation: scan-down 2.4s linear infinite; }
        .faceid-cam { position: absolute; inset: 16px; border: 1px dashed rgba(255,255,255,0.2); border-radius: 18px; }
        .faceid-text { position: absolute; bottom: 18px; width: 100%; text-align: center; color: white; font-weight: 700; letter-spacing: 1px; }

        /* --- RESPONSIVE OPTIMIZATION --- */
        @media (max-width: 1200px) {
            .main-content { padding: 20px; }
            .main-columns { grid-template-columns: 1fr; }
            .heart-stage { max-height: none; }
            .sidebar { display: none; }
            .logo { display: none; }
        }

        @media (max-width: 768px) {
            .browser-bar { padding: 0 16px; justify-content: space-between; }
            .url-bar { display: none; }
            .nav-icons { display: none; }
            .main-content { padding: 16px; gap: 20px; display: flex; flex-direction: column; }
            .main-columns { grid-template-columns: 1fr; }
            .page-title h1 { font-size: 36px; }
            .heart-stage { height: 320px; flex-shrink: 0; }
            .cards-grid { grid-template-columns: 1fr; }
            .organ-tray { justify-content: center; } /* Stack on mobile */
            .organ-item { width: 50px; height: 50px; }
            .organ-item i, .organ-item svg { font-size: 20px; }
        }

        @media (max-width: 1080px) {
            .sidebar { display: none; }
            .main-content { padding-bottom: 120px; }
            .main-columns { grid-template-columns: 1fr; }
            .bottom-nav { display: block; }
        }
    </style>
</head>
<body>

    <div class="boot-screen" id="boot-screen">
        <div class="logo" style="font-size:32px;">H<span>+</span> OS</div>
        <div class="boot-loader"><div class="boot-bar"></div></div>
        <div class="boot-text">INITIALIZING BIO-SYNC PROTOCOLS...</div>
        <button class="boot-cta" id="skip-boot"><i class="ph ph-fast-forward"></i> Skip intro</button>
    </div>

    <div class="app-container" id="app-container">
        <div class="browser-bar">
            <div class="window-controls">
                <div class="window-dot" style="background: #ef4444;"></div>
                <div class="window-dot" style="background: #f59e0b;"></div>
                <div class="window-dot" style="background: #10b981;"></div>
            </div>
            <div class="nav-icons"><i class="ph ph-caret-left"></i><i class="ph ph-caret-right"></i></div>
            <div class="url-bar"><i class="ph-fill ph-lock-key"></i><span>Healthflo.com</span><i class="ph ph-arrow-clockwise" style="margin-left: auto;"></i></div>
            <div class="branding-right">Health flo <span>OS NEO 3.0 Pro</span></div>
        </div>

        <div class="dashboard-body">
            <div class="main-content">

                <div class="header-section">
                    <div class="header-left">
                        <div class="top-toggles">
                            <div class="toggle-pill">Diagnose</div>
                            <div class="toggle-pill active" id="mode-pill"><div class="active-dot"></div> My Heart</div>
                        </div>
                        <div class="page-title">
                            <h2>Hi Dhivakaran,</h2>
                            <h1 id="main-diagnosis">Overview <span>Conditions</span></h1>
                        </div>
                        <div class="page-nav" id="page-nav"></div>
                        <div class="link-row" id="navigator-links"></div>
                    </div>
                    <button class="theme-toggle" id="theme-toggle">White Theme</button>
                </div>

                <div class="main-columns">

                    <div class="left-panel-container">
                        <div class="heart-stage">
                            <div class="sound-btn" id="sound-toggle"><i class="ph-fill ph-speaker-simple-high"></i></div>
                            <div class="rings"></div>
                            <div class="scanner-line"></div>
                            <div id="model-3d-container"></div>
                        </div>

                        <div class="organ-tray-wrapper">
                            <div class="section-header mini">Select Organ System</div>
                            <div class="organ-tray"></div>
                            <div class="link-row" id="organ-shortcuts"></div>
                        </div>

                        <div class="relocated-hub">
                            <div class="relocated-header">
                                <div class="logo">H<span>+</span></div>
                                <div class="version-pill"><i class="ph ph-seal-check"></i> Version 3 Pro</div>
                            </div>
                            <div class="relocated-grid">
                                <div class="patient-quick relocated-card">
                                    <div class="name">Dhivakaran</div>
                                    <div class="pill-row">
                                        <div class="pill"><i class="ph ph-pulse"></i>Daily readiness 92%</div>
                                        <div class="pill"><i class="ph ph-users-three"></i>Family tracking ON</div>
                                        <div class="pill"><i class="ph ph-shield-check"></i>Synced to devices</div>
                                    </div>
                                </div>

                                <div class="relocated-card nav-card">
                                    <div class="nav-label">Care navigation</div>
                                    <div class="sidebar-nav">
                                        <a class="nav-link active" href="patient-dashboard.html"><i class="ph-fill ph-heartbeat"></i>Daily dashboard</a>
                                        <a class="nav-link" href="patient-health.html"><i class="ph ph-activity"></i>Health graph</a>
                                        <a class="nav-link" href="patient-labs.html"><i class="ph ph-flask"></i>Latest labs</a>
                                        <a class="nav-link" href="patient-devices.html"><i class="ph ph-wifi-high"></i>Device streams</a>
                                        <a class="nav-link" href="patient-profile.html"><i class="ph ph-user"></i>Patient profile</a>
                                        <a class="nav-link" href="patient-settings.html"><i class="ph ph-gear"></i>Settings</a>
                                    </div>
                                    <div class="nav-label">Family + quick sync</div>
                                    <div class="nav-grid">
                                        <a class="nav-chip-tile" href="patient-family.html"><strong>Family watch</strong><span>Notify caregivers instantly</span></a>
                                        <a class="nav-chip-tile" href="patient-log.html"><strong>Daily log</strong><span>Minute-by-minute recap</span></a>
                                        <a class="nav-chip-tile" href="patient-insurance.html"><strong>Insurance desk</strong><span>Pre-approvals + claims</span></a>
                                        <a class="nav-chip-tile" href="patient-settings.html"><strong>Preferences</strong><span>Sync all modules</span></a>
                                    </div>
                                </div>

                                <div class="family-watch relocated-card">
                                    <div style="display:flex; justify-content:space-between; align-items:center;">
                                        <strong>Family is watching</strong>
                                        <span style="color:#10b981; font-weight:700; font-size:12px;">Live</span>
                                    </div>
                                    <div class="avatars">
                                        <div class="avatar">R</div>
                                        <div class="avatar">A</div>
                                        <div class="avatar">P</div>
                                        <div class="avatar" style="background:rgba(59,130,246,0.4);">+</div>
                                    </div>
                                    <div style="color:var(--text-muted); font-size:12px;">Share-ready links for guardians and partner.</div>
                                </div>

                                <div class="chat-drawer relocated-card" id="chat-drawer">
                                    <h4><span><i class="ph ph-robot"></i> AI Assistant</span><span class="status-dot"></span></h4>
                                    <div class="chat-messages" id="chat-messages"></div>
                                    <div class="chat-input-row">
                                        <input type="text" id="chat-input" placeholder="Describe symptoms e.g. pain, bleeding" />
                                        <button id="chat-send"><i class="ph ph-paper-plane-tilt"></i></button>
                                    </div>
                                </div>

                                <div class="sidebar-utilities relocated-card">
                                    <div class="label">Care tools</div>
                                    <button data-open-modal="video-modal"><i class="ph ph-video-camera"></i><span>Video Call</span></button>
                                    <button data-open-modal="pharmacy-modal"><i class="ph ph-pill"></i><span>Refill Rx</span></button>
                                    <button data-open-modal="files-modal"><i class="ph ph-folder"></i><span>Files</span></button>
                                    <button data-open-modal="insurance-modal"><i class="ph ph-shield-check"></i><span>Insurance</span></button>
                                    <button data-open-modal="faceid-overlay"><i class="ph ph-lock"></i><span>Secure</span></button>
                                    <button style="color:#ef4444; border-color: rgba(239,68,68,0.4);"><i class="ph ph-power"></i><span>Log out</span></button>
                                </div>
                            </div>

                            <div class="health-stack">
                                <div class="section-header" style="margin-bottom:4px;"><div class="blue-dot"></div> Version 3 · Health map</div>
                                <div class="health-grid">
                                    <div class="health-card" id="health-condition-card">
                                        <h4><i class="ph ph-pulse"></i> Condition</h4>
                                        <p id="health-condition-text">Reading lab + vitals to declare health.</p>
                                        <div class="badge-line" id="health-monitor-badges"></div>
                                    </div>
                                    <div class="health-card" id="visit-card">
                                        <h4><i class="ph ph-first-aid"></i> Visit / Admit</h4>
                                        <p id="visit-advice">Doctor visit guidance will appear here.</p>
                                        <div class="badge-line" id="visit-why"></div>
                                    </div>
                                    <div class="health-card" id="upcoming-card">
                                        <h4><i class="ph ph-calendar"></i> Upcoming</h4>
                                        <p id="upcoming-list">Lab tests, appointments, medicines will list here.</p>
                                        <div class="badge-line" id="upcoming-badges"></div>
                                    </div>
                                    <div class="health-card" id="family-share-card">
                                        <h4><i class="ph ph-users-three"></i> Family shares</h4>
                                        <p id="family-share-text">Share dashboard with trusted profiles.</p>
                                        <div class="badge-line" id="family-share-badges"></div>
                                    </div>
                                </div>

                                <div class="section-header" style="margin-bottom:4px;"><div class="blue-dot"></div> Version 3 Pro · Sync center</div>
                                <div class="sync-board" id="sync-board">
                                    <div class="sync-card">
                                        <div class="title"><i class="ph ph-gear-six"></i>Profile + settings</div>
                                        <div class="desc">Linked to patient profile and settings for consistent alerts and privacy.</div>
                                        <div class="meta"><span class="dot"></span> Synced</div>
                                        <a href="patient-settings.html">Open settings</a>
                                    </div>
                                    <div class="sync-card">
                                        <div class="title"><i class="ph ph-users"></i>Family oversight</div>
                                        <div class="desc">Guardians are watching the dashboard; daily summaries are shared.</div>
                                        <div class="meta"><span class="dot"></span> Live watchers 3</div>
                                        <a href="patient-family.html">Manage family access</a>
                                    </div>
                                    <div class="sync-card">
                                        <div class="title"><i class="ph ph-flask"></i>Labs + health pages</div>
                                        <div class="desc">Readiness pulls from labs, organs, and device streams across pages.</div>
                                        <div class="meta"><span class="dot"></span> Synced to dashboard</div>
                                        <a href="patient-health.html">View health graph</a>
                                    </div>
                                    <div class="sync-card">
                                        <div class="title"><i class="ph ph-shield-check"></i>Safety routines</div>
                                        <div class="desc">SOS, secure face ID, and insurance desk are pinned for quick use.</div>
                                        <div class="meta"><span class="dot"></span> Ready for daily checks</div>
                                        <a href="patient-insurance.html">Open insurance desk</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="right-panel-container">

                        <div class="insight-stack">
                            <div class="floating-stat" id="float-card">
                                <div style="display:flex; align-items:center; gap:8px;">
                                    <div class="live-badge"><div class="live-dot"></div> LIVE</div>
                                    <span style="font-size:11px; color:#9ca3af; font-weight:700;">Real-time telemetry</span>
                                </div>
                                <div style="font-size:24px; font-weight:800; margin-bottom:4px; color: var(--text-white);" id="main-stat">120 <span style="font-size:12px; font-weight:500;">bpm</span></div>
                                <svg width="100%" height="30" viewBox="0 0 200 30" id="live-ecg-svg" preserveAspectRatio="none">
                                    <path id="live-ecg-path" d="" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>

                            <div>
                                <div class="section-header" style="margin-bottom:8px;"><div class="blue-dot"></div> <span id="section-title">My Heart Condition</span></div>
                                <div class="cards-grid">
                                    <div class="data-card state-blue" id="card-1">
                                        <div class="card-head">
                                            <div><span class="card-title" id="c1-title">Blood Status</span><span class="card-val" id="c1-val">116/70</span></div>
                                            <i class="ph-fill ph-drop card-icon" id="c1-icon"></i>
                                        </div>
                                        <div class="bar-chart" id="blood-chart">
                                            <div class="bar" style="height:40%"></div><div class="bar" style="height:70%"></div><div class="bar" style="height:50%"></div><div class="bar act" style="height:90%"></div><div class="bar act" style="height:60%"></div><div class="bar" style="height:40%"></div>
                                        </div>
                                    </div>
                                    <div class="data-card active-blue" id="card-2">
                                        <div class="card-head">
                                            <div><span class="card-title" id="c2-title">Heart Rate</span><span class="card-val" id="c2-val">120 <span style="font-size:14px; font-weight:500;">bpm</span></span></div>
                                            <i class="ph ph-heartbeat card-icon" style="color:white;" id="c2-icon"></i>
                                        </div>
                                        <svg width="100%" height="50" style="margin-top:auto; opacity:0.8; overflow:visible;"><path id="card-wave-path" d="M0,25 Q10,25 15,10 T30,25 T45,40 T60,10 T75,25 T100,25" fill="none" stroke="#3b82f6" stroke-width="2.5" stroke-linecap="round"/></svg>
                                        <div class="blue-square-val"><span style="font-size:16px; font-weight:800;" id="box-bpm">120</span></div>
                                    </div>
                                    <div class="data-card state-blue" id="card-3">
                                        <div class="card-head">
                                            <div><span class="card-title" id="c3-title">Blood Count</span><span class="card-val" id="c3-val">80-90</span></div>
                                            <i class="ph-fill ph-chart-bar card-icon" id="c3-icon"></i>
                                        </div>
                                        <svg width="100%" height="40" style="margin-top:auto;"><path d="M0,20 Q25,5 50,20 T100,20" fill="none" stroke="#6b7280" stroke-width="2.5" stroke-linecap="round"/><circle cx="80" cy="20" r="4" fill="#3b82f6" /></svg>
                                    </div>
                                    <div class="data-card state-blue" id="card-4">
                                        <div class="card-head">
                                            <div><span class="card-title" id="c4-title">Glucose Level</span><span class="card-val" id="c4-val">230<small style="font-size:12px; color:#6b7280;">/ml</small></span></div>
                                            <i class="ph-fill ph-dna card-icon" id="c4-icon"></i>
                                        </div>
                                        <svg width="100%" height="40" style="margin-top:auto;"><path d="M0,20 L10,25 L20,15 L30,25 L40,15 L50,25 L60,15 L100,20" fill="none" stroke="#6b7280" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/></svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="schedule-area" style="margin-top: 10px;">
                            <div class="ai-panel" id="ai-panel">
                                <span class="ai-title" id="ai-title">AI ANALYSIS</span>
                                <p class="ai-text" id="ai-text">Patient vitals are stable. All organ functions within normal range. Monitoring active.</p>
                                <div class="typing" id="ai-typing">AI is typing...</div>
                            </div>

                            <!-- DISEASE GUIDANCE (HIDDEN BY DEFAULT) -->
                            <div class="guidance-panel" id="guidance-panel">
                                <div class="guidance-title">Action Plan: Dengue Management</div>
                                <ul class="guidance-list">
                                    <li>Monitor Platelets (Admit if < 20k)</li>
                                    <li>Immediate Hydration Required</li>
                                    <li>Check for bleeding spots</li>
                                    <li>Watch for window period (Day 3-7)</li>
                                </ul>
                            </div>

                            <div class="section-header" style="margin-bottom:8px; margin-top:10px;"><div class="blue-dot"></div> Care Schedule</div>
                            <div class="next-checkup">
                                <div><div style="font-size:10px; color:#9ca3af; margin-bottom:2px; font-weight: 600;">NEXT CHECKUP</div><div style="font-weight:700; font-size: 13px;">Fri, 24 Mar</div></div>
                                <i class="ph-fill ph-calendar-check" style="font-size:20px; color: var(--color-blue);"></i>
                             </div>
                        </div>

                </div>

            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-items">
                <button><i class="ph-fill ph-heartbeat"></i></button>
                <button><i class="ph ph-brain"></i></button>
                <button data-open-modal="video-modal"><i class="ph ph-video-camera"></i></button>
                <button data-open-modal="pharmacy-modal"><i class="ph ph-pill"></i></button>
                <button data-open-modal="files-modal"><i class="ph ph-folder"></i></button>
            </div>
        <div class="mobile-link-strip" id="mobile-nav-links"></div>
        </div>

        <button class="sos-btn" id="sos-btn">Hold for SOS</button>

        <div class="modal-overlay" id="video-modal">
            <div class="modal-box">
                <div class="modal-header"><h3>Telemedicine Call</h3><button class="ghost-btn" data-close="video-modal">Close</button></div>
                <div class="modal-body">
                    <p>Connecting to Dr. Lee... camera <strong id="cam-state">ON</strong></p>
                    <div style="display:flex; gap:10px;">
                        <button class="ghost-btn" id="toggle-cam">Toggle Camera</button>
                        <button class="primary-btn" id="end-call">End Call</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="pharmacy-modal">
            <div class="modal-box">
                <div class="modal-header"><h3>Pharmacy Refill</h3><button class="ghost-btn" data-close="pharmacy-modal">Close</button></div>
                <div class="modal-body">
                    <p>Select prescription to refill:</p>
                    <select id="rx-select" style="padding:10px; border-radius:10px; border:1px solid var(--glass-border); background: rgba(255,255,255,0.05); color:var(--text-white);">
                        <option>Atenolol 25mg</option>
                        <option>Losartan 50mg</option>
                        <option>Metformin 500mg</option>
                    </select>
                    <div class="modal-actions"><button class="primary-btn" id="submit-rx">Submit Refill</button></div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="insurance-modal">
            <div class="modal-box">
                <div class="modal-header"><h3>AI Insurance Desk</h3><button class="ghost-btn" data-close="insurance-modal">Close</button></div>
                <div class="modal-body">
                    <p>File a reimbursement claim instantly.</p>
                    <input type="text" placeholder="Hospital Name" style="padding:10px; border-radius:10px; border:1px solid var(--glass-border); background: rgba(255,255,255,0.05); color:white;">
                    <div style="display:flex; justify-content:space-between; background:rgba(16,185,129,0.1); padding:10px; border-radius:10px;">
                        <span>Approval Probability</span>
                        <strong style="color:#10b981;">94%</strong>
                    </div>
                    <div class="file-item">Upload Bill <button class="ghost-btn" style="font-size:10px;">Select</button></div>
                    <div class="modal-actions"><button class="primary-btn" id="submit-claim">File Claim</button></div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="files-modal">
            <div class="modal-box">
                <div class="modal-header"><h3>Medical Files & Labs</h3><button class="ghost-btn" data-close="files-modal">Close</button></div>
                <div class="modal-body">
                    <p style="font-size:11px; color:#9ca3af;">Upload lab reports for automatic diagnosis mapping.</p>
                    <div class="file-list">
                        <div class="file-item">
                            Dengue_Report_Lab_A.pdf 
                            <button class="danger-btn" id="simulate-dengue" style="font-size:10px;">Simulate Positive</button>
                        </div>
                        <div class="file-item">MRI_Report.pdf <button class="primary-btn" data-file="MRI_Report.pdf">Download</button></div>
                        <div class="file-item">Bloodwork_Results.png <button class="primary-btn" data-file="Bloodwork_Results.png">Download</button></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="faceid-overlay" id="faceid-overlay">
            <div class="faceid-box">
                <div class="faceid-cam"></div>
                <div class="faceid-scan"></div>
                <div class="faceid-text" id="faceid-text">Scanning Face ID...</div>
            </div>
        </div>

        <div class="toast" id="toast">Download started</div>

    </div>
    
    <script>
        // --- 1. EXPANDED SVG ICONS FOR ALL ORGANS ---
        const ORGAN_SVGS = {
            heart: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21s-7-4.5-7-10A4.5 4.5 0 0 1 9.5 6 4.5 4.5 0 0 1 12 7.5 4.5 4.5 0 0 1 14.5 6 4.5 4.5 0 0 1 19 11c0 5.5-7 10-7 10z"/></svg>`,
            brain: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 3a3 3 0 0 0-3 3v2a3 3 0 0 0-2 3v1a3 3 0 0 0 3 3h2v-2m4-10a3 3 0 0 1 3 3v2a3 3 0 0 1 2 3v1a3 3 0 0 1-3 3h-2v-2"/><path d="M9 3v8m6-8v8"/></svg>`,
            liver: `<svg viewBox="0 0 24 24"><path d="M20.5 13.5c-.5-3.5-3.5-6.5-8.5-6.5s-8 3-8 6.5c0 3.5 3 6.5 6 6.5 1.5 0 3-.5 4.5-1.5 3.5-2.5 5.5-3.5 6-5z" /><path d="M8 8.5v3" /></svg>`,
            lungs: `<svg viewBox="0 0 24 24"><path d="M12 2v20M6 5c-2.2 0-4 2.2-4 5.5S4 19 6.5 19 11 17 11 12 8.2 5 6 5zM18 5c2.2 0 4 2.2 4 5.5S20 19 17.5 19 13 17 13 12 15.8 5 18 5z" /></svg>`,
            kidneys: `<svg viewBox="0 0 24 24"><path d="M7.5 6c-2.5 0-4.5 2-4.5 5.5s3 7.5 6 7.5c2 0 3-1.5 3-4-1 1-3 0-3-2s2-3.5 4.5-3.5c-1-2.5-3.5-3.5-6-3.5z" /><path d="M16.5 6c2.5 0 4.5 2 4.5 5.5s-3 7.5-6 7.5c-2 0-3-1.5-3-4 1 1 3 0 3-2s-2-3.5-4.5-3.5c1-2.5 3.5-3.5 6-3.5z" /></svg>`,
            stomach: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 5c2-2 7-2 9 0 2 2 2 6 0 9-1 1.5-3 5-3 5-2 1-5 1-7-1s-3-5-2-8c1-3 3-5 3-5z"/><path d="M9 8h4"/></svg>`,
            intestines: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 4c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2v2c0 1.1-.9 2-2 2H8c-1.1 0-2-.9-2-2V4zm0 10c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2v2c0 1.1-.9 2-2 2H8c-1.1 0-2-.9-2-2v-2z" /></svg>`,
            pancreas: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7h-3c-1 0-2 .5-2.5 1.5l-2 4-2-4C10 7.5 9 7 8 7H4c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h4c1 0 2-.5 2.5-1.5l2-4 2 4c.5 1 1.5 1.5 2.5 1.5h3c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2z"/></svg>`,
            bladder: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4c-4 0-7 3-7 7v4c0 4 3 7 7 7s7-3 7-7v-4c0-4-3-7-7-7z"/><path d="M12 18v4"/></svg>`,
            spleen: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="12" rx="6" ry="9" /><path d="M12 3v18"/></svg>`,
            thyroid: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 6c0-2.2 2.2-4 5-4s5 1.8 5 4c0 1.5-1 2.8-2.5 3.5L12 14l-2.5-4.5C8 8.8 7 7.5 7 6z"/><path d="M12 14v6"/></svg>`,
            eyes: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12s4-6 10-6 10 6 10 6-4 6-10 6S2 12 2 12z"/><circle cx="12" cy="12" r="2.5"/></svg>`,
            gallbladder: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 3c-3 0-6 2.5-6 6 0 2 .5 3.5 1.5 4.5L12 18l2.5-4.5C15.5 12.5 16 11 16 9c0-1.5-.5-3-2-3z"/><path d="M12 18v3"/></svg>`,
            adrenal: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 14c0-5 3-8 8-8s8 3 8 8c0 3-2 5-5 5H9c-3 0-5-2-5-5z"/><path d="M9 12c1-1 3-1 4 0l2 2"/></svg>`,
            uterus: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 10c0-2 1.5-3.5 3.5-3.5H16c2 0 3.5 1.5 3.5 3.5 0 1.8-1.2 3.2-3 3.4l-2.5.3V21h-4v-7.3l-2.5-.3c-1.8-.2-3-1.6-3-3.4z"/><path d="M9 6v2m6-2v2"/></svg>`,
            prostate: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4c-4 0-6 3-6 6s2 6 6 6 6-3 6-6-2-6-6-6z"/><path d="M9 16v3c0 .6.4 1 1 1h4c.6 0 1-.4 1-1v-3"/></svg>`
        };

        // --- 2. COMPREHENSIVE ORGAN DATA & VITALS ---
        const ORGAN_DATA = {
            heart: {
                title: "Cardiovascular System",
                mainStat: "BPM", animKey: "bpm", simValue: 80, icon: "svg-heart",
                stats: [
                    { id: "c1", title: "Blood Pressure", base: 116, unit: "/70", icon: "ph-drop", type: "bp" },
                    { id: "c2", title: "Heart Rate", base: 80, unit: "bpm", icon: "ph-heartbeat", type: "bpm" },
                    { id: "c3", title: "O2 Saturation", base: 98, unit: "%", icon: "ph-activity", type: "norm" },
                    { id: "c4", title: "Cardiac Output", base: 5.2, unit: "L/min", icon: "ph-waves", type: "norm" }
                ],
                abnormal: { msg: "Arrhythmia Detected.", action: "Recommend immediate ECG." }
            },
            brain: {
                title: "Nervous System",
                mainStat: "Hz", animKey: "hz", simValue: 14, icon: "svg-brain",
                stats: [
                    { id: "c1", title: "Brain Waves", base: 14, unit: "Hz", icon: "ph-wave-sine", type: "hz" },
                    { id: "c2", title: "Cognitive Load", base: 45, unit: "%", icon: "ph-lightning", type: "perc" },
                    { id: "c3", title: "ICP", base: 11, unit: "mmHg", icon: "ph-gauge", type: "norm" },
                    { id: "c4", title: "Oxygenation", base: 99, unit: "%", icon: "ph-wind", type: "perc" }
                ],
                abnormal: { msg: "High Cortisol Levels.", action: "Stress reduction advised." }
            },
            lungs: {
                title: "Respiratory System",
                mainStat: "RPM", animKey: "rpm", simValue: 16, icon: "svg-lungs",
                stats: [
                    { id: "c1", title: "Resp Rate", base: 16, unit: "rpm", icon: "ph-wind", type: "rpm" },
                    { id: "c2", title: "SpO2 Level", base: 98, unit: "%", icon: "ph-drop", type: "perc" },
                    { id: "c3", title: "Lung Capacity", base: 4.8, unit: "L", icon: "ph-chart-bar", type: "norm" },
                    { id: "c4", title: "EtCO2", base: 38, unit: "mmHg", icon: "ph-cloud", type: "norm" }
                ],
                abnormal: { msg: "Reduced Airflow.", action: "Bronchodilator Check." }
            },
            liver: {
                title: "Hepatic System",
                mainStat: "Tox", animKey: "tox", simValue: 5, icon: "svg-liver",
                stats: [
                    { id: "c1", title: "ALT Enzymes", base: 29, unit: "U/L", icon: "ph-flask", type: "norm" },
                    { id: "c2", title: "Filter Eff.", base: 95, unit: "%", icon: "ph-shield-check", type: "perc" },
                    { id: "c3", title: "Bilirubin", base: 0.8, unit: "mg", icon: "ph-test-tube", type: "norm" },
                    { id: "c4", title: "Albumin", base: 4.2, unit: "g/dL", icon: "ph-egg", type: "norm" }
                ],
                abnormal: { msg: "Enzyme Spike.", action: "Liver panel required." }
            },
            kidneys: {
                title: "Renal System",
                mainStat: "GFR", animKey: "gfr", simValue: 90, icon: "svg-kidneys",
                stats: [
                    { id: "c1", title: "GFR", base: 95, unit: "mL", icon: "ph-activity", type: "norm" },
                    { id: "c2", title: "Creatinine", base: 0.9, unit: "mg", icon: "ph-flask", type: "norm" },
                    { id: "c3", title: "Urea (BUN)", base: 14, unit: "mg", icon: "ph-test-tube", type: "norm" },
                    { id: "c4", title: "Hydration", base: 92, unit: "%", icon: "ph-drop-half", type: "perc" }
                ],
                abnormal: { msg: "Filtration Low.", action: "Increase water intake." }
            },
            stomach: {
                title: "Gastric System",
                mainStat: "pH", animKey: "ph", simValue: 2, icon: "svg-stomach",
                stats: [
                    { id: "c1", title: "Acidity (pH)", base: 2.0, unit: "pH", icon: "ph-eyedropper", type: "norm" },
                    { id: "c2", title: "Motility", base: 3, unit: "cpm", icon: "ph-waves", type: "norm" },
                    { id: "c3", title: "Enzymes", base: 88, unit: "%", icon: "ph-flask", type: "perc" },
                    { id: "c4", title: "Lining Health", base: 95, unit: "%", icon: "ph-shield", type: "perc" }
                ],
                abnormal: { msg: "High Acidity.", action: "Neutralizer suggested." }
            },
            pancreas: {
                title: "Endocrine System",
                mainStat: "Glu", animKey: "glu", simValue: 100, icon: "svg-pancreas",
                stats: [
                    { id: "c1", title: "Insulin", base: 12, unit: "µU", icon: "ph-syringe", type: "norm" },
                    { id: "c2", title: "Glucose", base: 98, unit: "mg", icon: "ph-cube", type: "norm" },
                    { id: "c3", title: "Amylase", base: 50, unit: "U/L", icon: "ph-flask", type: "norm" },
                    { id: "c4", title: "Lipase", base: 45, unit: "U/L", icon: "ph-drop", type: "norm" }
                ],
                abnormal: { msg: "Insulin Resistance.", action: "Dietary adjustment." }
            },
            intestines: {
                title: "Digestive Tract",
                mainStat: "Abs", animKey: "abs", simValue: 85, icon: "svg-intestines",
                stats: [
                    { id: "c1", title: "Absorption", base: 92, unit: "%", icon: "ph-arrows-in", type: "perc" },
                    { id: "c2", title: "Microbiome", base: 85, unit: "Var", icon: "ph-bug", type: "perc" },
                    { id: "c3", title: "Motility", base: 8, unit: "/min", icon: "ph-wave-sine", type: "norm" },
                    { id: "c4", title: "Hydration", base: 70, unit: "%", icon: "ph-drop", type: "perc" }
                ],
                abnormal: { msg: "Inflammation.", action: "Probiotics recommended." }
            },
            bladder: {
                title: "Urinary System",
                mainStat: "Vol", animKey: "vol", simValue: 40, icon: "svg-bladder",
                stats: [
                    { id: "c1", title: "Volume", base: 350, unit: "ml", icon: "ph-cylinder", type: "norm" },
                    { id: "c2", title: "Pressure", base: 15, unit: "cm", icon: "ph-gauge", type: "norm" },
                    { id: "c3", title: "Flow Rate", base: 12, unit: "ml/s", icon: "ph-waves", type: "norm" },
                    { id: "c4", title: "Bacteria", base: 0, unit: "Neg", icon: "ph-prohibit", type: "norm" }
                ],
                abnormal: { msg: "High Pressure.", action: "Empty bladder soon." }
            },
            spleen: {
                title: "Lymphatic System",
                mainStat: "WBC", animKey: "wbc", simValue: 6, icon: "svg-spleen",
                stats: [
                    { id: "c1", title: "WBC Count", base: 6.5, unit: "k", icon: "ph-shield-plus", type: "norm" },
                    { id: "c2", title: "Platelets", base: 250, unit: "k", icon: "ph-bandaids", type: "norm" },
                    { id: "c3", title: "Filtration", base: 98, unit: "%", icon: "ph-funnel", type: "perc" },
                    { id: "c4", title: "Iron Store", base: 85, unit: "%", icon: "ph-magnet", type: "perc" }
                ],
                abnormal: { msg: "Enlargement.", action: "Scan required." }
            },
            thyroid: {
                title: "Thyroid Gland",
                mainStat: "TSH", animKey: "tsh", simValue: 2, icon: "svg-thyroid",
                stats: [
                    { id: "c1", title: "TSH", base: 2.1, unit: "mU", icon: "ph-chart-line-up", type: "norm" },
                    { id: "c2", title: "T4 Free", base: 1.2, unit: "ng", icon: "ph-flask", type: "norm" },
                    { id: "c3", title: "T3 Total", base: 120, unit: "ng", icon: "ph-test-tube", type: "norm" },
                    { id: "c4", title: "Metabolism", base: 100, unit: "%", icon: "ph-fire", type: "perc" }
                ],
                abnormal: { msg: "Hormone Imbalance.", action: "Endo consult." }
            },
            eyes: {
                title: "Ophthalmic System",
                mainStat: "IOP", animKey: "iop", simValue: 14, icon: "ph-eye",
                stats: [
                    { id: "c1", title: "Intraocular Pressure", base: 14, unit: "mmHg", icon: "ph-eye", type: "norm" },
                    { id: "c2", title: "Retina Perfusion", base: 98, unit: "%", icon: "ph-sun-dim", type: "perc" },
                    { id: "c3", title: "Pupil Response", base: 0.24, unit: "s", icon: "ph-activity", type: "norm" },
                    { id: "c4", title: "Dryness Index", base: 12, unit: "%", icon: "ph-drop-half", type: "perc" }
                ],
                abnormal: { msg: "Light sensitivity flagged.", action: "Route to ophthalmic screening." }
            },
            gallbladder: {
                title: "Biliary System",
                mainStat: "Flow", animKey: "bile", simValue: 72, icon: "svg-gallbladder",
                stats: [
                    { id: "c1", title: "Bile Flow", base: 72, unit: "%", icon: "ph-wave-sine", type: "perc" },
                    { id: "c2", title: "Cholesterol", base: 180, unit: "mg", icon: "ph-flask", type: "norm" },
                    { id: "c3", title: "Stones Risk", base: 8, unit: "%", icon: "ph-warning", type: "perc" },
                    { id: "c4", title: "pH", base: 7.2, unit: "pH", icon: "ph-drop", type: "ph" }
                ],
                abnormal: { msg: "Biliary slowdown detected.", action: "Schedule ultrasound." }
            },
            adrenal: {
                title: "Adrenal Axis",
                mainStat: "Cortisol", animKey: "cortisol", simValue: 14, icon: "svg-adrenal",
                stats: [
                    { id: "c1", title: "Cortisol", base: 14, unit: "µg/dL", icon: "ph-flashlight", type: "norm" },
                    { id: "c2", title: "Aldosterone", base: 7, unit: "ng/dL", icon: "ph-lightning", type: "norm" },
                    { id: "c3", title: "Stress Index", base: 32, unit: "%", icon: "ph-activity", type: "perc" },
                    { id: "c4", title: "BP Support", base: 110, unit: "mmHg", icon: "ph-gauge", type: "bp" }
                ],
                abnormal: { msg: "Cortisol spike.", action: "Order serum cortisol + ACTH." }
            },
            uterus: {
                title: "Reproductive System",
                mainStat: "Cycle", animKey: "cycle", simValue: 28, icon: "svg-uterus",
                stats: [
                    { id: "c1", title: "Cycle Day", base: 14, unit: "day", icon: "ph-calendar-blank", type: "norm" },
                    { id: "c2", title: "Endometrium", base: 8, unit: "mm", icon: "ph-clipboard-text", type: "norm" },
                    { id: "c3", title: "Hormone Balance", base: 92, unit: "%", icon: "ph-sparkle", type: "perc" },
                    { id: "c4", title: "Pain Index", base: 12, unit: "%", icon: "ph-thermometer-simple", type: "perc" }
                ],
                abnormal: { msg: "Cycle irregularity noted.", action: "Check hormones + ultrasound." }
            },
            prostate: {
                title: "Prostate Health",
                mainStat: "PSA", animKey: "psa", simValue: 1.2, icon: "svg-prostate",
                stats: [
                    { id: "c1", title: "PSA", base: 1.2, unit: "ng/mL", icon: "ph-flask", type: "norm" },
                    { id: "c2", title: "Flow Score", base: 92, unit: "%", icon: "ph-waves", type: "perc" },
                    { id: "c3", title: "Nocturia", base: 1, unit: "x", icon: "ph-moon", type: "norm" },
                    { id: "c4", title: "Inflammation", base: 6, unit: "%", icon: "ph-activity", type: "perc" }
                ],
                abnormal: { msg: "PSA trending high.", action: "Consider DRE + MRI." }
            }
        };
        
        const KEYWORD_RISK = {
            bleeding: 'Critical', pain: 'Severe', dizzy: 'Severe',
            nausea: 'Mild', faint: 'Critical', fever: 'Mild'
        };

         // GLOBAL STATES
        let activeOrgan = 'heart';
        let liveIntervals = [];
        let IS_DISEASED_MODE = false;
        let CURRENT_DISEASE = null;
        let currentVitalsSnapshot = { organ: 'heart', stats: [], ts: Date.now(), location: null };
        const LAB_SYNC_KEY = 'lab-dashboard-latest';
        const HEALTH_STATUS_KEY = 'health-board-status';
        const FAMILY_KEY = 'family-profiles';

        // --- 3. MAPPING LOGIC FOR GITHUB 3D MODELS ---
        const GITHUB_BASE = './3d_models/';
        const DISEASED_MODEL_MAP = { liver: 'cirrhotic_liver.glb' };

        const ORGAN_MODEL_MAP = {
            heart: 'heart.glb',
            brain: 'brain.glb',
            liver: 'liver.glb',
            lungs: 'lungs.glb',
            kidneys: 'kidneys.glb',
            stomach: 'stomach.glb',
            pancreas: 'pancreas.glb',
            intestines: 'intestines.glb',
            bladder: 'bladder.glb',
            spleen: 'spleen.glb',
            thyroid: 'thyroid.glb',
            eyes: 'eyes.glb',
            gallbladder: 'gallbladder.glb',
            adrenal: 'adrenal.glb',
            uterus: 'uterus.glb',
            prostate: 'prostate.glb'
        };

        const ORGAN_PAGE_LINKS = {
            heart: 'patient-organs.html#heart',
            brain: 'patient-organs.html#brain',
            lungs: 'patient-organs.html#lungs',
            liver: 'patient-organs.html#liver',
            kidneys: 'patient-organs.html#kidneys',
            stomach: 'patient-organs.html#stomach',
            pancreas: 'patient-organs.html#pancreas',
            intestines: 'patient-organs.html#intestines',
            bladder: 'patient-organs.html#bladder',
            spleen: 'patient-organs.html#spleen',
            thyroid: 'patient-organs.html#thyroid',
            eyes: 'patient-organs.html#eyes',
            gallbladder: 'patient-organs.html#gallbladder',
            adrenal: 'patient-organs.html#adrenal',
            uterus: 'patient-organs.html#uterus',
            prostate: 'patient-organs.html#prostate'
        };

        // --- THREE.JS SETUP ---
        let scene, camera, renderer, group, particles;
        let controls, spotLight, hemisphereLight;
        let currentModel = null;
        let activeAnimation = null;
        const gltfLoader = new THREE.GLTFLoader();
        const STANDARD_MODEL_SIZE = 5.5;
        const MODEL_OFFSETS = { lungs: new THREE.Vector3(0, -0.4, 0) };

        const initThree = () => {
            const container = document.getElementById('model-3d-container');
            if(!container) return;
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 0, 10);
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.physicallyCorrectLights = true;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.45;
            container.appendChild(renderer.domElement);
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 2.0;
            controls.enableZoom = false;
            controls.enablePan = false;
            controls.minDistance = camera.position.length();
            controls.maxDistance = camera.position.length();
            
            // Particles
            const particlesGeo = new THREE.BufferGeometry();
            const pCount = 300;
            const pArray = new Float32Array(pCount * 3);
            for (let i = 0; i < pCount * 3; i++) pArray[i] = (Math.random() - 0.5) * 15;
            particlesGeo.setAttribute("position", new THREE.BufferAttribute(pArray, 3));
            const particlesMat = new THREE.PointsMaterial({ size: 0.04, color: 0x3b82f6, transparent: true, opacity: 0.4, blending: THREE.AdditiveBlending });
            particles = new THREE.Points(particlesGeo, particlesMat);
            scene.add(particles);

            // Lighting
            scene.add(new THREE.AmbientLight(0xffffff, 0.25));
            hemisphereLight = new THREE.HemisphereLight(0xfff8e1, 0x0f172a, 0.9);
            scene.add(hemisphereLight);
            spotLight = new THREE.SpotLight(0xffffff, 3.6);
            spotLight.position.set(10, 10, 10);
            scene.add(spotLight);
            const rimLight = new THREE.PointLight(0x3b82f6, 4, 50);
            rimLight.position.set(-10, 5, -5);
            scene.add(rimLight);

            // Start Animation Loop
            const clock = new THREE.Clock();
            const animate = () => {
                requestAnimationFrame(animate);
                const t = clock.getElapsedTime();
                controls.update();
                if (group) {
                    group.position.y = Math.sin(t * 0.8) * 0.06;
                }
                if (activeAnimation) activeAnimation(t);
                if(particles) particles.rotation.y += 0.001;
                renderer.render(scene, camera);
            };
            animate();

            // Initial Load
            loadOrganModel('heart');

            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        };

        const getOrganColor = (type) => {
            // Color mapping based on state
            if (IS_DISEASED_MODE && (type === 'spleen' || type === 'liver' || type === 'heart')) return 0xff4d4d; // Disease Red

            const colors = {
                heart: 0xff3b3b, brain: 0x0ae0ff, liver: 0xd97757, lungs: 0xffa8d9,
                kidneys: 0xc27e5c, stomach: 0xff9e9e, intestines: 0xffc4a3, pancreas: 0xffd670,
                bladder: 0xffea00, spleen: 0x9370db, thyroid: 0xffb7b2, eyes: 0x7dd3fc,
                gallbladder: 0x4ade80, adrenal: 0xf97316, uterus: 0xec4899, prostate: 0x22c55e
            };
            return colors[type] || 0x3b82f6;
        };

        // --- 4. MODEL LOADING LOGIC (HEALTHY VS DISEASED) ---
        const loadOrganModel = (type) => {
            // Cleanup previous model
            if (group) {
                scene.remove(group);
                group.traverse((obj) => {
                    if (obj.geometry) obj.geometry.dispose();
                    if (obj.material) {
                        if(Array.isArray(obj.material)) obj.material.forEach(m=>m.dispose());
                        else obj.material.dispose();
                    }
                });
                group = null;
            }

            group = new THREE.Group();
            scene.add(group);
            const color = getOrganColor(type);

            currentModel = null;
            activeAnimation = null;

            // Construct Filename
            let filename = ORGAN_MODEL_MAP[type];
            if (!filename) {
                createProceduralFallback(type, color);
                return;
            }
            if (IS_DISEASED_MODE && DISEASED_MODEL_MAP[type]) filename = DISEASED_MODEL_MAP[type];

            const modelUrl = GITHUB_BASE + filename;

            // Load Model - Since we don't have local files, this will likely fail and trigger fallback
            // For the sake of this demo file, we default to fallback immediately for robustness, 
            // but keep the code structure in case you add files later.
            
            // Try loading, but expect failure in this standalone file
            gltfLoader.load(modelUrl, (gltf) => {
                const model = gltf.scene || gltf.scenes[0];

                model.traverse((node) => {
                    if (node.isMesh && node.material) {
                        if (node.material.map) {
                            node.material.map.encoding = THREE.sRGBEncoding;
                            node.material.map.anisotropy = 8;
                        }
                        node.material.emissiveIntensity = Math.max(0.1, node.material.emissiveIntensity || 0);
                        if (typeof node.material.roughness === 'number') node.material.roughness = Math.max(0.12, node.material.roughness * 0.75);
                        if (typeof node.material.metalness === 'number') node.material.metalness = Math.min(0.45, (node.material.metalness || 0.2) + 0.05);
                        node.material.needsUpdate = true;
                    }
                });

                centerAndScaleModel(model, type);
                group.add(model);
                currentModel = model;
                activeAnimation = buildOrganAnimation(type, model);

            }, undefined, (error) => {
                // FALLBACK: If GitHub file doesn't exist yet, show procedural shape
                createProceduralFallback(type, color);
            });
        };

        const centerAndScaleModel = (model, type) => {
            const box = new THREE.Box3().setFromObject(model);
            const size = box.getSize(new THREE.Vector3());
            const center = box.getCenter(new THREE.Vector3());
            const maxAxis = Math.max(size.x, size.y, size.z) || 1;
            const scale = STANDARD_MODEL_SIZE / maxAxis;
            model.scale.setScalar(scale);
            model.position.sub(center);
            if (MODEL_OFFSETS[type]) model.position.add(MODEL_OFFSETS[type]);
            model.updateMatrixWorld();
            model.userData.baseScale = scale;
            model.userData.basePosition = model.position.clone();
            controls.target.set(0, 0, 0);
            controls.update();
            camera.lookAt(0, 0, 0);
        };

        const createProceduralFallback = (type, color) => {
            let geometry;
            // Simple shapes to represent organs if GLB is missing
            switch (type) {
                case 'heart': geometry = new THREE.IcosahedronGeometry(2.2, 1); break;
                case 'brain': geometry = new THREE.DodecahedronGeometry(2.2, 0); break;
                // CapsuleGeometry requires newer Three.js (r137+), ensured via CDN link
                case 'lungs': geometry = new THREE.CylinderGeometry(1.5, 1.5, 3, 16); break;
                case 'kidneys': geometry = new THREE.CylinderGeometry(1.2, 1.2, 2.5, 8); break;
                case 'eyes': geometry = new THREE.SphereGeometry(2, 32, 16); break;
                case 'stomach': geometry = new THREE.TorusKnotGeometry(1.2, 0.4, 64, 8); break;
                case 'intestines': geometry = new THREE.TorusKnotGeometry(1.5, 0.3, 100, 16); break;
                case 'liver': geometry = new THREE.ConeGeometry(2, 3, 32); break;
                default: geometry = new THREE.OctahedronGeometry(2.0, 0);
            }
            const coreMat = new THREE.MeshStandardMaterial({
                color: color,
                metalness: 0.35,
                roughness: 0.32,
                clearcoat: 0.6,
                clearcoatRoughness: 0.25,
                transparent: true,
                opacity: 0.94,
            });
            const coreMesh = new THREE.Mesh(geometry, coreMat);
            centerAndScaleModel(coreMesh, type);
            group.add(coreMesh);
            currentModel = coreMesh;
            activeAnimation = buildOrganAnimation(type, coreMesh);
        };

        const buildOrganAnimation = (type, model) => {
            const baseScale = model.userData.baseScale || 1;
            const basePos = model.userData.basePosition ? model.userData.basePosition.clone() : model.position.clone();
            const irisParts = [];
            if (type === 'eyes') {
                model.traverse((node) => {
                    if (node.name && /iris/i.test(node.name)) irisParts.push(node);
                });
            }

            return (t) => {
                if (type === 'heart') {
                    const beat = 1 + Math.sin(t * 2.6) * 0.12;
                    model.scale.setScalar(baseScale * beat);
                    model.position.set(basePos.x, basePos.y + Math.sin(t * 2.6) * 0.08, basePos.z);
                } else if (type === 'lungs') {
                    const breath = 1 + Math.sin(t * 1.4) * 0.08;
                    model.scale.set(baseScale * breath, baseScale * (breath + 0.05), baseScale * breath);
                    model.position.set(basePos.x, basePos.y + Math.cos(t * 1.4) * 0.04, basePos.z);
                } else if (type === 'eyes') {
                    const dilate = 1 + Math.sin(t * 1.2) * 0.18;
                    if (irisParts.length) {
                        irisParts.forEach((n) => n.scale.setScalar(dilate));
                    } else {
                        model.scale.setScalar(baseScale * (0.96 + 0.06 * dilate));
                    }
                } else {
                    const subtle = 1 + Math.sin(t * 1.5) * 0.02;
                    model.scale.setScalar(baseScale * subtle);
                }
            };
        };

        const getLocationSnapshot = () => new Promise(resolve => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude, label: 'GPS' }),
                    () => resolve({ lat: 28.6139, lon: 77.2090, label: 'Fallback' }),
                    { timeout: 4000 }
                );
            } else {
                resolve({ lat: 28.6139, lon: 77.2090, label: 'Fallback' });
            }
        });

        const persistVitalsSnapshot = () => {
            if (!currentVitalsSnapshot.stats.length) return;
            getLocationSnapshot().then(loc => {
                const payload = { ...currentVitalsSnapshot, ts: Date.now(), location: loc };
                localStorage.setItem('dashboardVitals', JSON.stringify(payload));
                const log = JSON.parse(localStorage.getItem('medicalLog') || '[]');
                log.push({ ts: payload.ts, category: 'Vitals', organ: payload.organ, stats: payload.stats, location: loc });
                localStorage.setItem('medicalLog', JSON.stringify(log.slice(-300)));
                localStorage.setItem('lastLogTs', payload.ts);
            });
        };

        const parseLabSnapshot = () => {
            try { return JSON.parse(localStorage.getItem(LAB_SYNC_KEY)) || {}; }
            catch { return {}; }
        };

        const loadFamilyProfiles = () => {
            try {
                const stored = JSON.parse(localStorage.getItem(FAMILY_KEY) || '[]');
                if (stored.length) return stored;
            } catch {}
            return [
                { name: 'Riya (Sister)', role: 'Viewer', canShare: true },
                { name: 'Anand (Dad)', role: 'Guardian', canShare: true },
                { name: 'Priya (Partner)', role: 'Admin', canShare: true }
            ];
        };

        const writeHealthStatus = (payload) => {
            localStorage.setItem(HEALTH_STATUS_KEY, JSON.stringify({ ...payload, updated: Date.now() }));
        };

        const evaluateHealthFromLabs = () => {
            const snap = parseLabSnapshot();
            const panels = snap.latestPanels || {};
            const reports = (snap.reports || []).slice().sort((a, b) => new Date(b.date) - new Date(a.date));
            const latestReport = reports[0];

            let condition = 'Healthy';
            const reasons = [];
            const monitor = ['Heart rate', 'BP', 'Hydration'];
            let advice = 'Vitals steady. Routine follow-up.';

            const platelets = parseFloat(panels.platelets || 0);
            const wbc = parseFloat(panels.wbc || 0);
            const temperature = panels.temperature || 98.6;

            if (latestReport && /dengue/i.test(latestReport.name)) {
                condition = 'Dengue';
                reasons.push('Latest lab tagged dengue.');
                advice = 'Doctor review required. Admit if bleeding or platelets keep falling.';
                monitor.push('Platelets', 'Temperature', 'Hydration');
                activateDiseaseMode('Dengue Positive');
            } else if (latestReport && /malaria/i.test(latestReport.name)) {
                condition = 'Malaria';
                reasons.push('Malaria assay flagged.');
                advice = 'Doctor visit needed; monitor fever spikes and hydration.';
                monitor.push('Temperature', 'Hydration', 'BP');
            }

            if (platelets && platelets < 1.5) {
                condition = 'Dengue';
                reasons.push('Platelets trending low.');
            }
            if (wbc && wbc < 4) reasons.push('WBC low — infection watch');
            if (temperature && temperature > 100.4) monitor.push('Fever trend');

            const visitBadges = [];
            if (condition === 'Healthy') visitBadges.push('Home care');
            if (condition === 'Dengue') visitBadges.push('CBC every 24h', 'Admit if platelets <20k');
            if (condition === 'Malaria') visitBadges.push('Monitor fever q6h', 'Hydrate 2.5L/day');

            const upcoming = [];
            if (latestReport) upcoming.push(`${latestReport.name} • ${new Date(latestReport.date).toLocaleDateString()}`);
            (snap.history || []).filter(h => h.status === 'Scheduled').slice(0, 2).forEach(h => upcoming.push(`${h.title} • ${h.date}`));

            const meds = ['Orders mirrored to pharmacy', 'Delivery tracker ready'];

            const family = loadFamilyProfiles();
            const shareBadges = family.filter(f => f.canShare).map(f => `${f.name} • ${f.role}`);

            document.getElementById('health-condition-text').innerText = `${condition} — ${reasons[0] || 'Labs look calm.'}`;
            const monitorWrap = document.getElementById('health-monitor-badges');
            monitorWrap.innerHTML = '';
            monitor.forEach(item => {
                const span = document.createElement('span'); span.innerText = item; monitorWrap.appendChild(span);
            });

            document.getElementById('visit-advice').innerText = advice;
            const visitWrap = document.getElementById('visit-why');
            visitWrap.innerHTML = '';
            visitBadges.forEach(item => { const s=document.createElement('span'); s.innerText=item; visitWrap.appendChild(s); });

            const upcomingList = document.getElementById('upcoming-list');
            upcomingList.innerText = upcoming.length ? upcoming.join(' · ') : 'No new bookings — auto-sync on next lab booking.';
            const upcomingBadges = document.getElementById('upcoming-badges');
            upcomingBadges.innerHTML = '';
            meds.concat(upcoming.slice(0,2)).forEach(item => { const s=document.createElement('span'); s.innerText=item; upcomingBadges.appendChild(s); });

            const familyText = document.getElementById('family-share-text');
            familyText.innerText = shareBadges.length ? 'Dashboard shared live.' : 'Family mirroring off.';
            const familyBadges = document.getElementById('family-share-badges');
            familyBadges.innerHTML = '';
            shareBadges.forEach(item => { const s=document.createElement('span'); s.innerText=item; familyBadges.appendChild(s); });

            document.getElementById('ai-text').innerText = `${condition} mode: ${advice}`;

            writeHealthStatus({ condition, monitor, advice, reasons, upcoming, meds, latestReport });
        };

        // --- DASHBOARD UI UPDATES ---
        const getColorClass = (val, type) => {
            // Logic for critical values
            if (IS_DISEASED_MODE) {
                if (type === 'perc' && val < 20) return 'state-red'; // Platelets
            }

            if (type === 'bpm' && (val < 60 || val > 100)) return 'state-yellow';
            if (type === 'perc' && val < 90) return 'state-yellow';
            return Math.random() > 0.95 ? 'state-red' : 'state-blue';
        };

        const updateCardValue = (idx, val, unit, type, title) => {
            const card = document.getElementById(`card-${idx}`);
            const state = getColorClass(val, type);
            
            // Override colors based on Disease state
            let finalState = state;
            if (IS_DISEASED_MODE && val < 50 && unit === 'k') finalState = 'state-red';

            if(idx !== 2) card.className = `data-card ${finalState}`;
            else card.className = finalState === 'state-red' ? `data-card state-red` : `data-card active-blue`;

            document.getElementById(`c${idx}-val`).innerHTML = `${val} <span style="font-size:12px;opacity:0.6;">${unit}</span>`;

            const statTitle = title || document.getElementById(`c${idx}-title`)?.innerText || 'Stat';
            currentVitalsSnapshot.organ = activeOrgan;
            currentVitalsSnapshot.ts = Date.now();
            currentVitalsSnapshot.stats[idx - 1] = { label: statTitle, val: `${val} ${unit}` };
            
            // Sync Main Stats if card 2
            if (idx === 2) {
                document.getElementById('main-stat').innerHTML = `${val} <span style="font-size:12px;font-weight:500;">${unit}</span>`;
                const boxBpm = document.getElementById('box-bpm');
                if(boxBpm) boxBpm.innerText = val;
            }
        };

        const updateUI = (organType) => {
            activeOrgan = organType;
            const data = ORGAN_DATA[organType];
            
            // Text Updates
            document.getElementById('section-title').innerHTML = `<div class="blue-dot"></div> ${data.title}`;
            document.getElementById('mode-pill').innerHTML = `<div class="active-dot"></div> My ${organType.charAt(0).toUpperCase() + organType.slice(1)}`;
            
            // Reveal Data after delay
            data.stats.forEach((s, i) => {
                const idx = i + 1;
                document.getElementById(`c${idx}-title`).innerText = s.title;
                document.getElementById(`c${idx}-icon`).className = `ph-fill ${s.icon} card-icon`;
                
                // If Disease Mode & Spleen, override stats
                if (IS_DISEASED_MODE && organType === 'spleen') {
                    if (s.title === "Platelets") s.base = 25; // Critical Low
                    if (s.title === "WBC Count") s.base = 2.1; // Low
                }

                updateCardValue(idx, s.base, s.unit, s.type, s.title);
            });
            startLiveSimulation(organType);
            updateOrganShortcuts(organType);
        };
        
        const startLiveSimulation = (organ) => {
            liveIntervals.forEach(clearInterval);
            liveIntervals = [];
            const data = ORGAN_DATA[organ];

            const mainInt = setInterval(() => {
                data.stats.forEach((s, i) => {
                    let val = parseFloat(s.base);
                    
                    // Disease Logic Simulation
                    if (IS_DISEASED_MODE && organ === 'spleen' && s.title === 'Platelets') {
                        // Slowly drop platelets
                        val = Math.max(10, val - 0.5); 
                        s.base = val; 
                    }

                    let flux = (Math.random() - 0.5) * (val * 0.1); 
                    let newVal = Math.floor(val + flux);
                    if(s.unit === 'pH' || s.unit.includes('L') || (s.unit === 'k' && newVal < 10)) newVal = (val + flux/10).toFixed(1);
                    
                    updateCardValue(i+1, newVal, s.unit, s.type, s.title);
                });
                document.querySelectorAll('.bar').forEach(b => b.style.height = `${30 + Math.random() * 70}%`);
            }, 2000);
            liveIntervals.push(mainInt);
        };

        const generateOrganButtons = () => {
            const tray = document.querySelector('.organ-tray');
            tray.innerHTML = '';
            Object.keys(ORGAN_DATA).forEach(key => {
                const data = ORGAN_DATA[key];
                const btn = document.createElement('div');
                btn.className = `organ-item ${key === 'heart' ? 'selected' : ''}`;
                btn.dataset.organ = key;
                let iconHtml = '';
                if (data.icon.startsWith('svg-')) {
                    const svgKey = data.icon.split('-')[1];
                    iconHtml = ORGAN_SVGS[svgKey] || '<i class="ph ph-warning"></i>'; 
                } else {
                    iconHtml = `<i class="ph ${data.icon}"></i>`;
                }
                btn.innerHTML = `<div class="premium-icon"><i class="ph-fill ph-seal-check"></i></div>${iconHtml}`;
                tray.appendChild(btn);
            });
        };

        const updateOrganShortcuts = (organType) => {
            const wrap = document.getElementById('organ-shortcuts');
            if(!wrap) return;
            const organName = organType.charAt(0).toUpperCase() + organType.slice(1);
            const shortcuts = [
                { label: `${organName} in atlas`, href: ORGAN_PAGE_LINKS[organType] || 'patient-organs.html', icon: 'ph-map-trifold' },
                { label: 'Related labs', href: 'patient-labs.html', icon: 'ph-flask' },
                { label: 'Device stream', href: 'patient-devices.html', icon: 'ph-wifi-high' }
            ];
            wrap.innerHTML = '';
            shortcuts.forEach(link => {
                const a = document.createElement('a');
                a.className = 'nav-chip';
                a.href = link.href;
                a.innerHTML = `<i class="ph ${link.icon}"></i>${link.label}`;
                wrap.appendChild(a);
            });
        };

        // --- DISEASE SIMULATION LOGIC ---
        const activateDiseaseMode = (disease) => {
            IS_DISEASED_MODE = true;
            CURRENT_DISEASE = disease;
            
            // 1. Update UI Headers
            document.getElementById('main-diagnosis').innerHTML = `Overview <span>${disease}</span>`;
            document.getElementById('main-diagnosis').style.color = '#ef4444';
            
            // 2. AI Panel Alert
            const aiPanel = document.getElementById('ai-panel');
            aiPanel.className = 'ai-panel warn';
            document.getElementById('ai-title').innerText = "CRITICAL DIAGNOSIS DETECTED";
            document.getElementById('ai-text').innerText = `Lab reports confirm ${disease}. Systemic inflammation detected. Switching to monitoring mode.`;
            
            // 3. Show Guidance
            document.getElementById('guidance-panel').style.display = 'block';

            // 4. Force Switch to Relevant Organ (Spleen for Dengue)
            if (disease === 'Dengue Positive') {
                activeOrgan = 'spleen';
                // Trigger manual update
                const btn = document.querySelector('[data-organ="spleen"]');
                if(btn) btn.click();
            }

            // 5. Toast
            const toast = document.getElementById('toast');
            toast.innerText = "Diagnosis Updated: Dengue Fever";
            toast.style.display = "block";
            setTimeout(() => toast.style.display = "none", 3000);
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const PAGES = [
                { label: 'Dashboard', href: 'patient-dashboard.html', icon: 'ph-fill ph-heartbeat' },
                { label: 'Organs', href: 'patient-organs.html', icon: 'ph ph-brain' },
                { label: 'Health', href: 'patient-health.html', icon: 'ph ph-activity' },
                { label: 'Labs', href: 'patient-labs.html', icon: 'ph ph-flask' },
                { label: 'Profile', href: 'patient-profile.html', icon: 'ph ph-user' },
                { label: 'Settings', href: 'patient-settings.html', icon: 'ph ph-gear' }
            ];
            const pageNav = document.getElementById('page-nav');
            if(pageNav) {
                PAGES.forEach(p => {
                    const link = document.createElement('a');
                    link.href = p.href;
                    link.innerHTML = `<i class="${p.icon}"></i>${p.label}`;
                    pageNav.appendChild(link);
                });
            }

            const NAVIGATOR_LINKS = [
                { label: 'Hospitals', href: 'patient-hospitals.html', icon: 'ph-buildings' },
                { label: 'Devices', href: 'patient-devices.html', icon: 'ph-devices' },
                { label: 'Pharmacy', href: 'patient-pharmacy.html', icon: 'ph-capsules' },
                { label: 'Family', href: 'patient-family.html', icon: 'ph-users' },
                { label: 'Insurance', href: 'patient-insurance.html', icon: 'ph-shield-check' },
                { label: 'Settings', href: 'patient-settings.html', icon: 'ph-gear' }
            ];
            const navigatorRow = document.getElementById('navigator-links');
            if(navigatorRow) {
                NAVIGATOR_LINKS.forEach(linkInfo => {
                    const a = document.createElement('a');
                    a.className = 'nav-chip';
                    a.href = linkInfo.href;
                    a.innerHTML = `<i class="ph ${linkInfo.icon}"></i>${linkInfo.label}`;
                    navigatorRow.appendChild(a);
                });
            }

            const hideBootScreen = () => {
                const boot = document.getElementById('boot-screen');
                const app = document.getElementById('app-container');
                if(!boot || !app || boot.classList.contains('hide-fast')) return;
                boot.classList.add('hide-fast');
                app.style.opacity = '1';
                setTimeout(() => { boot.style.display = 'none'; }, 600);
            };

            // Boot Sequence with user bypass and failsafe
            setTimeout(hideBootScreen, 1200);
            setTimeout(hideBootScreen, 4500);

            const skipBtn = document.getElementById('skip-boot');
            if(skipBtn) skipBtn.addEventListener('click', hideBootScreen);

            generateOrganButtons();
            initThree();
            updateUI('heart');
            evaluateHealthFromLabs();
            persistVitalsSnapshot();
            setInterval(persistVitalsSnapshot, 600000);

            const openModal = (target) => {
                const el = document.getElementById(target);
                if(!el) return;
                el.style.display = 'flex';
                if (target === 'faceid-overlay') {
                    const status = document.getElementById('faceid-text');
                    if (status) {
                        status.innerText = 'Scanning Face ID...';
                        setTimeout(() => status.innerText = 'Secure tunnel ready', 1200);
                        setTimeout(() => el.style.display = 'none', 2200);
                    }
                }
            };
            document.querySelectorAll('[data-open-modal]').forEach(btn => {
                btn.addEventListener('click', () => openModal(btn.dataset.openModal));
            });
            
            // Event Listeners
            const tray = document.querySelector('.organ-tray');
            tray.addEventListener('click', (e) => {
                const btn = e.target.closest('.organ-item');
                if(!btn) return;
                document.querySelectorAll('.organ-item').forEach(b => b.classList.remove('selected'));
                document.querySelectorAll('.organ-label').forEach(el => el.remove());
                btn.classList.add('selected');
                
                const organ = btn.dataset.organ;
                loadOrganModel(organ);
                updateUI(organ);
            });

            // Modal Logic
            document.querySelectorAll('.ghost-btn').forEach(btn => btn.addEventListener('click', (e) => {
                const target = e.target.dataset.close;
                if(target) document.getElementById(target).style.display = 'none';
            }));

            // SIMULATE DENGUE BUTTON
            document.getElementById('simulate-dengue').addEventListener('click', () => {
                document.getElementById('files-modal').style.display = 'none';
                activateDiseaseMode('Dengue Positive');
                evaluateHealthFromLabs();
            });

            document.getElementById('theme-toggle').addEventListener('click', () => {
                document.body.classList.toggle('theme-white');
            });
        });
    </script>
</body> 
</html>
